"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunksound_particle_visualization"] = self["webpackChunksound_particle_visualization"] || []).push([["main"],{

/***/ "./node_modules/css-loader/dist/cjs.js!./src/styles.css":
/*!**************************************************************!*\
  !*** ./node_modules/css-loader/dist/cjs.js!./src/styles.css ***!
  \**************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../node_modules/css-loader/dist/runtime/noSourceMaps.js */ \"./node_modules/css-loader/dist/runtime/noSourceMaps.js\");\n/* harmony import */ var _node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../node_modules/css-loader/dist/runtime/api.js */ \"./node_modules/css-loader/dist/runtime/api.js\");\n/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _node_modules_css_loader_dist_runtime_getUrl_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../node_modules/css-loader/dist/runtime/getUrl.js */ \"./node_modules/css-loader/dist/runtime/getUrl.js\");\n/* harmony import */ var _node_modules_css_loader_dist_runtime_getUrl_js__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_getUrl_js__WEBPACK_IMPORTED_MODULE_2__);\n// Imports\n\n\n\nvar ___CSS_LOADER_URL_IMPORT_0___ = new URL(/* asset import */ __webpack_require__(/*! ./fonts/Garet-Book.ttf */ \"./src/fonts/Garet-Book.ttf\"), __webpack_require__.b);\nvar ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default()((_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default()));\n___CSS_LOADER_EXPORT___.push([module.id, \"@import url(https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap);\"]);\nvar ___CSS_LOADER_URL_REPLACEMENT_0___ = _node_modules_css_loader_dist_runtime_getUrl_js__WEBPACK_IMPORTED_MODULE_2___default()(___CSS_LOADER_URL_IMPORT_0___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `/* Import Google Font - Space Grotesk */\n\n/* Base styles */\n@font-face {\n    font-family: 'Garet';\n    src: url(${___CSS_LOADER_URL_REPLACEMENT_0___}) format('ttf');      \n    font-display: swap; \n}\n\n* {\n    scrollbar-width: none; \n    -ms-overflow-style: none; \n}\n\n*::-webkit-scrollbar { \n    display: none; \n}\n\ncanvas {\n    display: block;\n}\n\nbody, html {\n    margin: 0;\n    padding: 0;\n    overflow: hidden;\n    width: 100vw;\n    height: 100vh;\n    scrollbar-width: none;\n    -ms-overflow-style: none;\n}\n\nbody::-webkit-scrollbar,\nhtml::-webkit-scrollbar {\n    display: none;\n}\n\n#visualization-container {\n    position: relative;\n    width: 100vw;\n    height: 100vh;\n}\n\n#controls {\n    position: absolute;\n    top: 10px;\n    left: 10px;\n    z-index: 10;\n    background: rgba(255, 255, 255, 0.8);\n    padding: 10px;\n    border-radius: 5px;\n}\n\ncanvas#evolve2d {\n    position: absolute;\n    top: 0;\n    left: 0;\n    display: block;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: auto;\n}\n\n\n\n/* Top navigation bar */\n.top-nav {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 60px;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 20px;\n    z-index: 2000;\n    pointer-events: none;\n    box-sizing: border-box;\n}\n\n.top-nav-left,\n.top-nav-right {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    pointer-events: auto;\n}\n\n/* Bottom navigation bar */\n.bottom-nav {\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    height: 60px;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 20px;\n    z-index: 2000;\n    pointer-events: none;\n    box-sizing: border-box;\n}\n\n.bottom-nav-left,\n.bottom-nav-right {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    pointer-events: auto;\n}\n\n\n\n/* Base style for all main screen buttons */\n.main-screen-btn {\n    font-family: 'Space Grotesk', sans-serif;\n    padding: 0 0;\n    border: none;\n    background: transparent;\n    color: rgb(255, 254, 246);\n    cursor: pointer;\n    font-size: 1.3em;\n    transition: all 0.2s ease;\n    position: relative;\n    font-weight: 300;\n    letter-spacing: 0.08em;\n    text-shadow: 2px 2px 2px rgba(255, 255, 255, 0.25);\n    display: inline-block;\n    width: auto;\n    overflow: hidden;\n}\n\n\n\n/* Remove underline animations for hamburger menu */\n.main-screen-btn::after {\n    display: none;\n}\n\n/* Remove selected state underline */\n.main-screen-btn.selected::after {\n    display: none;\n}\n\n/* Smooth text transition for changing button text */\n.main-screen-btn .button-text {\n    display: block;\n    overflow: hidden;\n}\n\n/* Use the same approach as your working example */\n.main-screen-btn .button-text.old,\n.main-screen-btn .button-text.new {\n    display: block;\n    overflow: hidden;\n    transition: all 1.4s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.main-screen-btn .button-text.old {\n    height: auto;\n    opacity: 1;\n    width: auto;\n}\n\n.main-screen-btn .button-text.new {\n    color: #fff;\n    height: 0;\n    opacity: 0.1;\n    width: 0;\n}\n\n.main-screen-btn.text-changing .button-text.old {\n    height: 0px;\n    opacity: 0.1;\n    width: 0px;\n}\n\n.main-screen-btn.text-changing .button-text.new {\n    height: auto;\n    opacity: 1;\n    width: auto;\n}\n\n/* Hidden state */\n.main-screen-btn.hidden {\n    display: none !important;\n}\n\n/* Active/pressed state */\n.main-screen-btn:active {\n    transform: translateY(0);\n    color: #9999997a;\n}\n\n/* Floating buttons (for save mode) */\n.save-to-library-btn {\n    position: absolute;\n    z-index: 2000;\n    margin: 5px;\n    padding: 8px 12px;\n    border: none;\n    border-radius: 5px;\n    background-color: #ffc107;\n    color: black;\n    cursor: pointer;\n    font-size: 0.9em;\n}\n\n.save-to-library-btn:hover {\n    background-color: #e0a800;\n}\n\n.save-combination-btn {\n    position: fixed;\n    bottom: 32px;\n    left: 50%;\n    transform: translateX(-50%);\n    z-index: 3000;\n    padding: 12px 24px;\n    background: transparent; /* CHANGED: Transparent like submit button */\n    color: #C9FBFF; /* CHANGED: Cyan text */\n    border: 1px solid rgba(201, 251, 255, 0.4); /* CHANGED: Cyan border */\n    border-radius: 25px;\n    font-family: 'Space Grotesk', sans-serif;\n    font-size: 14px;\n    font-weight: 300;\n    letter-spacing: 0.08em;\n    cursor: pointer;\n    box-shadow: none; /* CHANGED: Remove shadow */\n    transition: all 0.3s ease;\n    text-shadow: 0 0 4px rgba(201, 251, 255, 0.3); /* CHANGED: Cyan glow */\n}\n\n.save-combination-btn:hover {\n    background: rgba(201, 251, 255, 0.1) !important; /* CHANGED: Cyan hover background */\n    color: #C9FBFF;\n    border-color: rgba(201, 251, 255, 0.6) !important; /* CHANGED: Brighter cyan */\n    text-shadow: 0 0 8px rgba(201, 251, 255, 0.6),\n                 0 0 12px rgba(201, 251, 255, 0.4);\n    filter: brightness(1.4);\n    transform: translateX(-50%) translateY(-2px) !important; /* CHANGED: Lift effect */\n   \n}\n\n.save-combination-btn:active {\n    transform: translateX(-50%) translateY(0px) !important;\n    box-shadow: 0 2px 8px rgba(201, 251, 255, 0.2) !important;\n}\n\n/* 3D Save to Library Button */\n.save-to-library-btn-3d {\n    position: absolute;\n    z-index: 2000;\n    background: transparent !important;\n    border: none !important;\n    cursor: pointer;\n    border-radius: 0;\n    transition: all 0.2s ease;\n    padding: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    position: relative;\n}\n\n/* REMOVED: No 2D icon pseudo-elements */\n.save-to-library-btn-3d::before,\n.save-to-library-btn-3d::after {\n    display: none;\n}\n\n/* Show glow on hover - radiating from center with filled core */\n.save-to-library-btn-3d:hover {\n    /* CHANGED: Add inset shadow to fill the center + outward glow */\n    box-shadow: inset 0 0 calc(var(--btn-size, 60px) * 0.5) calc(var(--btn-size, 60px) * 0.2) rgba(0, 255, 170, 0.5),\n                0 0 calc(var(--btn-size, 60px) * 0.333) rgba(0, 255, 170, 0.6),\n                0 0 calc(var(--btn-size, 60px) * 0.5) rgba(0, 255, 170, 0.4),\n                0 0 calc(var(--btn-size, 60px) * 0.667) rgba(0, 255, 170, 0.2);\n    border-radius: 50%; /* CHANGED: Circular to match the radial glow */\n    border: none !important;\n}\n\n/* Selection styles */\n.selected-solid {\n    outline: 3px solid #00ff00 !important;\n    outline-offset: 2px;\n}\n\n.hovered-solid {\n    outline: 2px solid #00aaff !important;\n    outline-offset: 1px;\n}\n\n.selected-solid.hovered-aura {\n    box-shadow: 0 0 16px 6px rgba(83, 211, 192, 0.4), 0 0 8px 2px rgba(83, 211, 192, 0.3) !important; /* CHANGED: reduced opacity from 1.0 to 0.4/0.3 */\n    outline: 3px solid rgba(83, 211, 192, 0.6) !important; /* CHANGED: reduced opacity from 1.0 to 0.6 */\n    outline-offset: 2px;\n}\n\n/* Name input overlay */\n.name-input-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    background-color: rgba(0, 0, 0, 0.7);\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    z-index: 5000;\n    backdrop-filter: blur(8px);\n    -webkit-backdrop-filter: blur(8px);\n}\n\n.name-input-widget {\n    background: rgba(0, 20, 40, 0.95);\n    padding: 32px 28px 24px 28px;\n    border-radius: 25px;\n    box-shadow: 0 8px 32px rgba(0,0,0,0.2);\n    text-align: center;\n    min-width: 250px;\n    font-family: 'Space Grotesk', sans-serif;\n    color: #C9FBFF; /* CHANGED: Cyan text */\n    border: 1px solid rgba(201, 251, 255, 0.2); /* CHANGED: Cyan border */\n    backdrop-filter: blur(16px);\n    -webkit-backdrop-filter: blur(16px);\n}\n\n.name-input-widget h3 {\n    margin: 0 0 20px 0;\n    color: #C9FBFF; /* CHANGED: Cyan heading */\n    font-size: 1.2em;\n    font-family: 'Space Grotesk', sans-serif;\n    font-weight: 400;\n    letter-spacing: 0.05em;\n    text-shadow: 0 0 8px rgba(201, 251, 255, 0.2); /* CHANGED: Cyan glow */\n}\n\n.name-input-widget input {\n    width: 100%;\n    padding: 12px;\n    border: 1px solid rgba(201, 251, 255, 0.3); /* CHANGED: Cyan border */\n    border-radius: 15px;\n    font-size: 1em;\n    margin-bottom: 20px;\n    box-sizing: border-box;\n    background: rgba(0, 20, 40, 0.85);\n    color: #C9FBFF; /* CHANGED: Cyan text */\n    font-family: 'Space Grotesk', sans-serif;\n    transition: all 0.3s ease;\n    font-weight: 300;\n}\n\n.name-input-widget input::placeholder {\n    color: rgba(201, 251, 255, 0.5); /* CHANGED: Cyan placeholder */\n}\n\n.name-input-widget input:focus {\n    outline: none;\n    border-color: rgba(201, 251, 255, 0.6); /* CHANGED: Brighter cyan on focus */\n    box-shadow: 0 0 12px rgba(201, 251, 255, 0.3);\n    background: rgba(0, 20, 40, 0.95);\n}\n\n.name-input-buttons {\n    display: flex;\n    gap: 56px;\n    justify-content: center;\n}\n\n.name-input-btn {\n    padding: 12px 24px;\n    border: 1px solid rgba(201, 251, 255, 0.3); /* CHANGED: Cyan border */\n    border-radius: 25px;\n    font-size: 1em;\n    cursor: pointer;\n    font-family: 'Space Grotesk', sans-serif;\n    background: transparent; /* CHANGED: Transparent background */\n    color: #C9FBFF; /* CHANGED: Cyan text */\n    transition: all 0.3s ease;\n    font-weight: 300;\n    letter-spacing: 0.05em;\n    text-shadow: 0 0 4px rgba(201, 251, 255, 0.3); /* CHANGED: Cyan glow */\n    min-width: 48px;\n    min-height: 48px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.name-input-btn.save {\n    color: #53d3c0; /* CHANGED: Green from palette */\n    border-color: rgba(83, 211, 192, 0.3); /* ADD THIS LINE - Green border */\n    text-shadow: 0 0 4px rgba(83, 211, 192, 0.3); /* CHANGED: Green glow */\n}\n\n.name-input-btn.save:hover {\n    background: rgba(83, 211, 192, 0.15); /* CHANGED: Green highlight */\n    color: #53d3c0;\n    border-color: rgba(83, 211, 192, 0.6); /* ADD THIS LINE - Brighter green */\n    text-shadow: 0 0 8px rgba(83, 211, 192, 0.6),\n                 0 0 12px rgba(83, 211, 192, 0.4);\n    filter: brightness(1.3);\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px rgba(83, 211, 192, 0.2);\n}\n\n.name-input-btn.cancel {\n    background: transparent;\n    color: #C9FBFF; /* CHANGED: Cyan */\n    \n}\n\n.name-input-btn.cancel:hover {\n    background: rgba(255, 0, 0, 0.1); /* Subtle red tint */\n    color: #ff6b6b; /* Light red */\n    \n    text-shadow: 0 0 8px rgba(255, 107, 107, 0.4);\n    filter: brightness(1.4);\n    transform: translateY(-2px);\n}\n\n/* Name input button icons */\n.name-input-icon {\n    width: 24px;\n    height: 24px;\n    filter: brightness(0) saturate(100%) invert(93%) sepia(14%) saturate(1048%) hue-rotate(154deg) brightness(103%) contrast(100%);\n    transition: filter 0.2s;\n}\n\n.name-input-btn.save .name-input-icon {\n    /* Green icon for save button */\n    filter: brightness(0) saturate(100%) invert(75%) sepia(24%) saturate(744%) hue-rotate(126deg) brightness(95%) contrast(85%);\n}\n\n.name-input-btn:hover .name-input-icon {\n    /* Brighter on hover */\n    filter: brightness(0) saturate(100%) invert(100%) sepia(8%) saturate(800%) hue-rotate(154deg) brightness(108%) contrast(100%);\n}\n\n.name-input-btn.save:hover .name-input-icon {\n    /* Brighter green on save hover */\n    filter: brightness(0) saturate(100%) invert(80%) sepia(24%) saturate(900%) hue-rotate(126deg) brightness(100%) contrast(90%);\n}\n\n/* Hamburger Menu Styles */\n.hamburger-menu {\n    position: fixed;\n    top: 20px;\n    left: 20px;\n    z-index: 3000;\n    pointer-events: auto;\n}\n\n.hamburger-button {\n    width: 48px;\n    height: 48px;\n    background: transparent;\n    border: none;\n    cursor: pointer;\n    padding: 0;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    transition: transform 0.2s ease, opacity 0.3s ease;\n    border-radius: 50%;\n    pointer-events: auto;\n}\n\n.hamburger-button img {\n    width: 100%;\n    height: 100%;\n    filter: brightness(0) saturate(100%) invert(93%) sepia(14%) saturate(1048%) hue-rotate(154deg) brightness(103%) contrast(100%) drop-shadow(0 0 4px rgba(201, 251, 255, 0.4));\n}\n\n.hamburger-button:hover {\n    transform: scale(1.1);\n}\n\n.hamburger-button:hover img {\n    filter: brightness(0.4) saturate(100%) invert(97%) sepia(20%) saturate(1400%) hue-rotate(154deg) brightness(115%) contrast(108%) drop-shadow(0 0 16px rgba(201, 251, 255, 0.4));\n}\n\n\n\n.hamburger-line {\n    width: 18px;\n    height: 2px;\n    background-color: #C9FBFF; /* CHANGED: Match soundscape cyan color */\n    transition: all 0.3s ease;\n    transform-origin: center;\n    box-shadow: 0 0 4px rgba(201, 251, 255, 0.4); /* CHANGED: Match cyan glow */\n}\n\n/* NEW: Add hover effect matching soundscape */\n.hamburger-button:hover .hamburger-line {\n    /* More aggressive brightness boost - same as soundscape button */\n    filter: brightness(1.5) drop-shadow(0 0 8px rgba(201, 251, 255, 0.9));\n}\n\n.hamburger-button.open .hamburger-line:nth-child(1),\n.hamburger-button.open .hamburger-line:nth-child(2),\n.hamburger-button.open .hamburger-line:nth-child(3) {\n    transform: none;\n    opacity: 1;\n}\n\n.hamburger-button.open .hamburger-line {\n    box-shadow: 0 0 8px rgba(201, 251, 255, 0.5); /* CHANGED: Cyan glow when open */\n}\n\n.hamburger-options {\n    position: absolute;\n    top: 64px;\n    left: 0;\n    display: flex;\n    flex-direction: column;\n    gap: 3%;\n    padding: 2%;\n    min-width: 150px;\n    opacity: 0;\n    visibility: hidden;\n    transform: translateY(-2%);\n    transition: all 0.3s ease;\n}\n\n.hamburger-options.open {\n    opacity: 1;\n    visibility: visible;\n    transform: translateY(0);\n}\n\n.hamburger-options .main-screen-btn {\n    margin: 0;\n    padding: 2% 0;\n    text-align: left;\n    font-size: 1.1em;\n    white-space: nowrap;\n    color: #C9FBFF; /* CHANGED: Match cyan color */\n    text-shadow: 0 0 4px rgba(201, 251, 255, 0.3); /* CHANGED: Add cyan glow */\n    transition: all 0.2s ease; /* NEW: Add transition */\n}\n\n/* NEW: Unified hover effect matching soundscape button */\n.hamburger-options .main-screen-btn:hover {\n    color: #C9FBFF;\n    text-shadow: 0 0 2px rgba(201, 251, 255, 0.7), /* Bright cyan glow */\n                 0 0 12px rgba(201, 251, 255, 0.4); /* Extended glow */\n    filter: brightness(1.5);\n    transform: translateX(4px); /* Subtle slide on hover */\n}\n\n.hamburger-options .main-screen-btn::after {\n    display: none;\n}\n\n\n\n/* Evolving Widget Styles - Fix white background */\n.evolve-overlay {\n    position: fixed;\n    top: 0; \n    left: 0; \n    width: 100vw; \n    height: 100vh;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    z-index: 6000;\n    background: transparent; \n    backdrop-filter: blur(8px);\n    -webkit-backdrop-filter: blur(8px);\n    padding: 0;\n}\n\n.evolve-widget {\n    width: 600px;\n    height: 400px;\n    max-width: 90vw;\n    max-height: 70vh;\n    min-width: 320px;\n    min-height: 300px;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n    background: transparent;\n    position: relative;\n    border-radius: 1rem;\n    box-sizing: border-box;\n    backdrop-filter: none; \n    -webkit-backdrop-filter: none;\n}\n\n/* Tabs Container - Remove white background */\n.evolve-tabs-container {\n    flex-shrink: 0;\n    background: rgba(0, 0, 0, 0.3); \n    backdrop-filter: blur(16px);\n    -webkit-backdrop-filter: blur(16px);\n    border-radius: 1rem 1rem 0 0;\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-bottom: none;\n    margin: 0.7em 0.7em 0 0.7em;\n}\n\n/* Tabs List */\n.evolve-tabs-list {\n    display: grid;\n    grid-template-columns: repeat(4, 1fr);\n    gap: 4px;\n    padding: 8px;\n    background: transparent;\n    border-radius: 1rem 1rem 0 0;\n}\n\n/* Tab Trigger Buttons */\n.evolve-tab-trigger {\n    font-family: 'Space Grotesk', sans-serif;\n    font-size: 0.9em;\n    font-weight: 300;\n    letter-spacing: 0.025em;\n    padding: 12px 16px;\n    border: 1px solid rgba(255, 255, 255, 0.15);\n    background: rgba(0, 0, 0, 0.2); \n    color: rgba(255, 255, 255, 0.8);\n    cursor: pointer;\n    border-radius: 8px;\n    transition: all 0.2s ease;\n    backdrop-filter: blur(8px);\n    -webkit-backdrop-filter: blur(8px);\n}\n\n.evolve-tab-trigger:hover {\n    background: rgba(0, 0, 0, 0.4); \n    color: rgba(255, 255, 255, 1);\n    border-color: rgba(255, 255, 255, 0.3);\n}\n\n.evolve-tab-trigger.active {\n    background: rgba(0, 255, 136, 0.2); \n    color: #0059ff;\n    border-color: rgba(0, 255, 136, 0.4);\n    box-shadow: 0 0 12px rgba(0, 255, 136, 0.15);\n}\n\n/* Content Area - Remove white background */\n.evolve-content-area {\n    flex: 1;\n    position: relative;\n    overflow: hidden;\n    background: rgba(0, 0, 0, 0.3);\n    backdrop-filter: blur(16px);\n    -webkit-backdrop-filter: blur(16px);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 0 0 1rem 1rem;\n    margin: 0 0.7em 0.7em 0.7em;\n}\n\n.evolve-content-area canvas {\n    width: 100% !important;\n    height: 100% !important;\n    border-radius: 0 0 1rem 1rem;\n    background: transparent !important;\n}\n\n/* Close Button */\n.evolve-close-btn {\n    position: absolute;\n    top: 12px;\n    right: 12px;\n    width: 32px;\n    height: 32px;\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    background: rgba(0, 0, 0, 0.3);\n    backdrop-filter: blur(16px);\n    -webkit-backdrop-filter: blur(16px);\n    color: white;\n    border-radius: 50%;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 18px;\n    font-weight: 300;\n    transition: all 0.2s ease;\n    z-index: 10;\n}\n\n.evolve-close-btn:hover {\n    background: rgba(255, 0, 0, 0.2);\n    border-color: rgba(255, 0, 0, 0.4);\n    transform: scale(1.1);\n}\n\n/* Floating info panel for Library Space */\n.library-space-panel {\n    pointer-events: auto;\n    position: fixed;\n    right: 0;\n    top: 0;\n    width: 400px;\n    height: 100vh;\n    padding: 40px 32px;\n    background: rgba(0, 20, 40, 0.97);\n    color: #C9FBFF;\n    border-left: 1px solid rgba(201, 251, 255, 0.3);\n    box-shadow: -4px 0 32px rgba(0, 0, 0, 0.5);\n    font-family: 'Space Grotesk', sans-serif;\n    z-index: 2000;\n    display: none;\n    overflow-y: auto;\n    backdrop-filter: blur(20px);\n    -webkit-backdrop-filter: blur(20px);\n    \n    /* Smooth slide-in animation */\n    transform: translateX(100%);\n    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), padding-bottom 0.3s ease; /* UPDATED */\n}\n\n.library-space-panel.visible {\n    display: block;\n    transform: translateX(0);\n}\n\n.library-space-panel .library-name {\n    font-family: 'Space Grotesk', sans-serif;\n    font-size: 2rem;\n    font-weight: 600;\n    color: #C9FBFF;\n    margin: 0 0 8px 0;\n    text-shadow: 0 0 12px rgba(201, 251, 255, 0.3);\n    word-break: break-word;       /* NEW */\n    white-space: normal;          /* NEW */\n    max-width: 100%;              /* NEW */\n    line-height: 1.2;             /* NEW */\n}\n\n.library-space-panel .library-category-label {\n    font-size: 1rem;\n    font-weight: 400;\n    color: #53d3c0;\n    margin-bottom: 24px;\n    letter-spacing: 0.05em;\n\n    text-shadow: 0 0 8px rgba(83, 211, 192, 0.3);\n}\n\n.library-space-panel .library-description {\n    width: 100%;\n    font-size: 1rem;\n    color: rgba(201, 251, 255, 0.8);\n    background: transparent;\n    border: none;\n    outline: none;\n    resize: none;\n    min-height: 3em;\n    line-height: 1.6;\n    margin: 0 0 32px 0;\n    font-family: 'Space Grotesk', sans-serif;\n    transition: background 0.2s;\n    border-radius: 8px;\n    padding: 12px;\n    white-space: pre-wrap;\n    word-break: break-word;\n}\n\n.library-space-panel .library-description:focus {\n    background: rgba(201, 251, 255, 0.05);\n}\n\n.library-space-panel .library-description.committed {\n    padding: 0;\n}\n\n.library-space-panel .library-desc-placeholder {\n    opacity: 0.5;\n    font-style: italic;\n    color: rgba(201, 251, 255, 0.5);\n}\n\n.library-info-actions {\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n    padding-top: 16px;\n}\n\n.library-info-btn {\n    width: 100%;\n    font-family: 'Space Grotesk', sans-serif;\n    font-size: 1rem;\n    font-weight: 400;\n    padding: 14px 20px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 12px;\n    background: transparent;\n    border: 1px solid rgba(201, 251, 255, 0.3);\n    border-radius: 12px;\n    color: #C9FBFF;\n    transition: all 0.3s ease;\n    text-shadow: 0 0 4px rgba(201, 251, 255, 0.3);\n}\n\n.library-info-btn-play{\n    \n    width: 100%;\n    font-family: 'Space Grotesk', sans-serif;\n    font-size: 1rem;\n    font-weight: 400;\n    padding: 14px 20px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 12px;\n    background: transparent;\n    border: 1px solid rgba(201, 251, 255, 0.3);\n    border-radius: 12px;\n    color: #C9FBFF;\n    transition: all 0.3s ease;\n    text-shadow: 0 0 4px rgba(201, 251, 255, 0.3);\n    padding-left: 2px;\n}\n.library-info-btn-play:hover {\n    background: rgba(201, 251, 255, 0.1);\n    border-color: rgba(201, 251, 255, 0.6);\n    text-shadow: 0 0 8px rgba(201, 251, 255, 0.6);\n    filter: brightness(1.3);\n    transform: translateY(-2px);\n   \n}\n.library-info-btn:hover {\n    background: rgba(201, 251, 255, 0.1);\n    border-color: rgba(201, 251, 255, 0.6);\n    text-shadow: 0 0 8px rgba(201, 251, 255, 0.6);\n    filter: brightness(1.3);\n    transform: translateY(-2px);\n   \n}\n\n.library-info-btn.secondary {\n    border-color: rgba(201, 251, 255, 0.2);\n}\n\n/* Library button icons */\n.library-btn-icon {\n    width: 24px;\n    height: 24px;\n    filter: brightness(0) saturate(100%) invert(93%) sepia(14%) saturate(1048%) hue-rotate(154deg) brightness(103%) contrast(100%);\n    transition: filter 0.2s;\n}\n.library-btn-icon-play{\n    width: 32px;\n    height: 32px;\n    \n    filter: brightness(0) saturate(100%) invert(93%) sepia(14%) saturate(1048%) hue-rotate(154deg) brightness(103%) contrast(100%);\n    transition: filter 0.2s;\n\n}\n.library-info-btn:hover .library-btn-icon {\n    filter: brightness(0) saturate(100%) invert(100%) sepia(8%) saturate(800%) hue-rotate(154deg) brightness(108%) contrast(100%);\n}\n\n/* Close button for library panel */\n.library-close-btn {\n    position: absolute;\n    top: 20px;\n    right: 20px;\n    width: 32px;\n    height: 32px;\n    background: transparent;\n    border: 1px solid rgba(201, 251, 255, 0.3);\n    border-radius: 50%;\n    color: #C9FBFF;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 20px;\n    transition: all 0.3s ease;\n    z-index: 10;\n}\n\n.library-close-btn:hover {\n    background: rgba(201, 251, 255, 0.1);\n    border-color: rgba(201, 251, 255, 0.6);\n    transform: scale(1.1);\n}\n\n/* Soundscape play/stop button */\n.soundscape-toggle-btn {\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    z-index: 3000;\n    width: 48px;\n    height: 48px;\n    background: transparent;\n    border: none;\n    cursor: pointer;\n    padding: 0;\n    transition: transform 0.2s ease, opacity 0.3s ease;\n    pointer-events: auto;\n}\n\n.soundscape-toggle-btn img {\n    width: 100%;\n    height: 100%;\n    /* Color: #C9FBFF with shadow */\n    filter: brightness(0) saturate(100%) invert(93%) sepia(14%) saturate(1048%) hue-rotate(154deg) brightness(103%) contrast(100%) drop-shadow(0 0 4px rgba(201, 251, 255, 0.4));\n}\n\n.soundscape-toggle-btn:hover {\n    transform: scale(1.1);\n}\n\n.soundscape-toggle-btn:hover img {\n    /* More aggressive brightness boost */\nfilter: brightness(0.4) saturate(100%) invert(97%) sepia(20%) saturate(1400%) hue-rotate(154deg) brightness(115%) contrast(108%) drop-shadow(0 0 8px rgba(201, 251, 255, 0.9));\n    /* Brighter on hover */\n}\n\n.soundscape-toggle-btn:active {\n    transform: scale(0.95);\n}\n\n.soundscape-toggle-btn.hidden {\n    opacity: 0;\n    pointer-events: none;\n}\n\n/* ===========================\n   Title Screen\n   =========================== */\n\n.title-screen {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    z-index: 10000;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    background: #0a0a20;\n    cursor: pointer;\n    transition: opacity 1s ease-out;\n}\n\n\n\n\n\n/* Add animations for logo and message */\n.title-screen.fade-out .title-logo-container {\n    animation: logoFadeOut 1.0s ease-out forwards;\n}\n\n.title-screen.fade-out .title-press-message {\n    animation: messageFadeOut 1.0s ease-out forwards;\n}\n\n@keyframes logoFadeOut {\n    0% {\n        opacity: 1;\n       \n    }\n    100% {\n        opacity: 0;\n     \n    }\n}\n\n@keyframes messageFadeOut {\n    0% {\n        opacity: 1;\n    }\n    100% {\n        opacity: 0;\n    }\n}\n\n/* Add fade-in for main scene */\nbody.scene-fade-in {\n    animation: sceneFadeIn 1s ease-in forwards;\n}\n\n@keyframes sceneFadeIn {\n    0% {\n        filter: brightness(0);\n    }\n    100% {\n        filter: brightness(1);\n    }\n}\n\n.title-stars-canvas {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 1;\n}\n\n.title-logo-container {\n    position: relative;\n    z-index: 2;\n    max-width: 50%;\n    max-height: 40vh;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    animation: logoGlow 3s ease-in-out infinite alternate;\n}\n\n.title-logo {\n    width: 100%;\n    height: auto;\n    max-height: 40vh;\n    object-fit: contain;\n    filter: drop-shadow(0 0 20px rgba(201, 251, 255, 0.5))\n            drop-shadow(0 0 40px rgba(201, 251, 255, 0.4))\n            drop-shadow(0 0 60px rgba(201, 251, 255, 0.2));\n    animation: logoFloat 4s ease-in-out infinite;\n}\n\n\n\n\n\n\n.title-press-message {\n    position: relative;\n    z-index: 2;\n    margin-top: 60px;\n    font-family: 'Space Grotesk', sans-serif;\n    font-size: 1.0rem;\n    font-weight: 200;\n    color: #C9FBFF;\n    letter-spacing: 0.1em;\n    text-transform: uppercase;\n    animation: messagePulse 3s ease-in-out infinite;\n    text-shadow: 0 0 10px rgba(201, 251, 255, 0.5),\n                 0 0 20px rgba(201, 251, 255, 0.3);\n}\n\n@keyframes messagePulse {\n    0%, 100% {\n        opacity: 0.4;\n        \n    }\n    50% {\n        opacity: 1;\n        \n    }\n}\n\n/* ===========================\n   Loading Screen\n   =========================== */\n\n.loading-screen {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    z-index: 10001; /* Above title screen */\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(10, 10, 32, 0.95);\n    backdrop-filter: blur(10px);\n    -webkit-backdrop-filter: blur(10px);\n    transition: opacity 0.5s ease-out;\n}\n\n.loading-screen.fade-out {\n    opacity: 0;\n    pointer-events: none;\n}\n\n.loading-content {\n    text-align: center;\n    animation: loadingPulse 2s ease-in-out infinite;\n}\n\n.loading-text {\n    font-family: 'Space Grotesk', sans-serif;\n    font-size: 1.4rem;\n    font-weight: 400;\n    color: #C9FBFF;\n    letter-spacing: 0.15em;\n    text-transform: uppercase;\n    text-shadow: 0 0 20px rgba(201, 251, 255, 0.2),\n                 0 0 40px rgba(201, 251, 255, 0.3);\n}\n\n.loading-dots {\n    display: inline-block;\n    min-width: 1.5em;\n    text-align: left;\n}\n\n\n\n/* Responsive adjustments */\n@media (max-width: 768px) {\n    .title-logo-container {\n        max-width: 85%;\n        max-height: 30vh;\n    }\n    \n    .title-logo {\n        max-height: 30vh;\n    }\n    \n    .title-press-message {\n        font-size: 1rem;\n        margin-top: 40px;\n    }\n}\n\n@media (max-height: 600px) {\n    .title-logo-container {\n        max-height: 35vh;\n    }\n    \n    .title-logo {\n        max-height: 35vh;\n    }\n    \n    .title-press-message {\n        margin-top: 30px;\n        font-size: 1.1rem;\n    }\n}\n\n@media (max-width: 900px) {\n    .evolve-widget {\n        width: 95vw;\n        height: 85vh;\n        min-width: 320px;\n        min-height: 300px;\n    }\n    \n    .evolve-tabs-list {\n        grid-template-columns: repeat(2, 1fr);\n        gap: 6px;\n    }\n    \n    .evolve-tab-trigger {\n        font-size: 0.8em;\n        padding: 10px 12px;\n    }\n}\n\n@media (max-width: 700px) {\n    .evolve-widget {\n        width: 98vw;\n        height: 90vh;\n        min-width: 0;\n        min-height: 0;\n    }\n}\n\n/* Floating Evolve Tabs Container */\n.evolve-tabs-floating {\n    position: fixed;\n    top: 20px;\n    left: 50%;\n    transform: translateX(-50%);\n    display: none;\n    flex-direction: row;\n    gap: 10px;\n    z-index: 1000;\n    \n    padding: 10px;\n    border-radius: 25px;\n    \n}\n\n/* Evolve Tab Button */\n.evolve-tab-button {\n    padding: 8px 16px;\n    background: transparent;\n    color: #C9FBFF; /* CHANGED: Match cyan color */\n    border: 1px solid rgba(201, 251, 255, 0.2); /* CHANGED: Cyan border */\n    border-radius: 15px;\n    font-family: 'Space Grotesk', sans-serif;\n    font-size: 14px;\n    font-weight: 400;\n    letter-spacing: 0.05em;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    text-shadow: 0 0 4px rgba(201, 251, 255, 0.3); /* CHANGED: Cyan glow */\n}\n\n.evolve-tab-button.active,\n.evolve-tab-button.selected {\n    background: rgba(201, 251, 255, 0.15); /* CHANGED: Cyan highlight */\n    border-color: rgba(201, 251, 255, 0.4);\n    box-shadow: 0 0 12px rgba(201, 251, 255, 0.2);\n}\n\n.evolve-tab-button:hover {\n    background: rgba(201, 251, 255, 0.1); /* CHANGED: Cyan hover */\n    color: #C9FBFF;\n    border-color: rgba(201, 251, 255, 0.4);\n    text-shadow: 0 0 8px rgba(201, 251, 255, 0.6), /* CHANGED: Brighter cyan glow */\n                 0 0 12px rgba(201, 251, 255, 0.4);\n    filter: brightness(1.3);\n    transform: translateY(-2px);\n}\n\n/* Evolving Submit Button */\n.evolving-submit-button {\n    position: fixed;\n    bottom: 20px;\n    left: 50%;\n    transform: translateX(-50%);\n    padding: 12px 24px;\n    background: transparent;\n    color: #C9FBFF; /* Cyan text */\n    border: 1px solid rgba(201, 251, 255, 0.4); /* Cyan border */\n    border-radius: 25px;\n    font-family: 'Space Grotesk', sans-serif;\n    font-size: 14px;\n    font-weight: 300;\n    letter-spacing: 0.08em;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    opacity: 0.6;\n    pointer-events: none;\n    z-index: 1000;\n    text-shadow: 0 0 4px rgba(201, 251, 255, 0.3); /* Cyan glow */\n}\n\n.evolving-submit-button.enabled {\n    opacity: 1;\n    pointer-events: auto;\n}\n\n.evolving-submit-button:hover {\n    background: rgba(201, 251, 255, 0.1) !important; /* Cyan hover background */\n    border-color: rgba(201, 251, 255, 0.6) !important; /* Brighter cyan border */\n    color: #C9FBFF !important;\n   \n    text-shadow: 0 0 8px rgba(201, 251, 255, 0.6), /* CHANGED: Brighter cyan glow */\n                 0 0 12px rgba(201, 251, 255, 0.4);\n    transform: translateX(-50%) translateY(-2px) !important; /* Lift effect */\n    \n}\n\n.evolving-submit-button:active {\n    transform: translateX(-50%) translateY(0px) !important;\n    box-shadow: 0 2px 8px rgba(201, 251, 255, 0.2) !important;\n}\n\n/* Update the .evolve-category-btn styles (around line 1230) */\n\n.evolve-category-btn.evolving {\n    background: linear-gradient(135deg, rgba(201, 251, 255, 0.2) 0%, rgba(201, 251, 255, 0.1) 100%); /* CHANGED: Cyan gradient */\n    cursor: wait;\n    opacity: 0.7;\n    animation: evolvingPulse 1.5s ease-in-out infinite;\n    border-color: rgba(201, 251, 255, 0.4);\n}\n\n.evolve-category-btn:disabled {\n    cursor: not-allowed;\n    opacity: 0.5;\n}\n\n@keyframes evolvingPulse {\n    0%, 100% {\n        opacity: 0.7;\n        box-shadow: 0 0 8px rgba(201, 251, 255, 0.2); /* NEW: Pulsing cyan glow */\n    }\n    50% {\n        opacity: 0.9;\n        box-shadow: 0 0 16px rgba(201, 251, 255, 0.4);\n    }\n}\n\n/* Update the already-saved message styling */\n.name-input-widget p {\n    font-size: 1em;\n    color: #C9FBFF; /* Cyan text instead of #e8f0ff */\n    margin-bottom: 20px;\n    text-align: center;\n    font-family: 'Space Grotesk', sans-serif;\n    font-weight: 300;\n    letter-spacing: 0.02em;\n}\n\n.name-input-widget p strong {\n    color: #53d3c0; /* Green from palette instead of #00ffaa */\n    font-size: 1.1em;\n    font-weight: 500;\n    text-shadow: 0 0 8px rgba(83, 211, 192, 0.4); /* Green glow */\n}\n\n.library-space-panel.editing-active {\n    padding-bottom: 140px;\n}\n\n.library-name {\n    font-family: 'Space Grotesk', sans-serif;\n    font-size: 2rem;\n    font-weight: 600;\n    color: #C9FBFF;\n    margin: 0 0 8px 0;\n    text-shadow: 0 0 12px rgba(201, 251, 255, 0.3);\n    word-break: break-word;       /* NEW */\n    white-space: normal;          /* NEW */\n    max-width: 100%;              /* NEW */\n    line-height: 1.2;             /* NEW */\n}\n\n.library-space-panel.editing-active .library-name {\n    margin-bottom: 40px;\n}\n\n.library-name-edit {\n    font-family: 'Space Grotesk', sans-serif;\n    font-size: 2rem;\n    font-weight: 600;\n    color: #C9FBFF;\n    background: rgba(0, 20, 40, 0.9);\n    border: 1px solid rgba(201, 251, 255, 0.4);\n    border-radius: 12px;\n    padding: 10px 14px;\n    margin: 0 0 24px 0;\n    text-shadow: 0 0 12px rgba(201, 251, 255, 0.3);\n    \n    transition: all 0.3s ease;\n}\n\n.library-name-edit:focus {\n    outline: none;\n    border-color: rgba(201, 251, 255, 0.6);\n    box-shadow: 0 0 18px rgba(201, 251, 255, 0.35);\n    background: rgba(0, 20, 40, 1);\n}\n\n.library-description-edit {\n    width: 100%;\n    min-height: 6.5em;\n    padding: 14px 16px;\n    background: rgba(0, 20, 40, 0.9);\n    border: 1px solid rgba(201, 251, 255, 0.35);\n    border-radius: 12px;\n    font-family: 'Space Grotesk', sans-serif;\n    font-size: 1rem;\n    color: #C9FBFF;\n    resize: vertical;\n    line-height: 1.6;\n    \n    transition: all 0.3s ease;\n    margin-bottom: 28px;\n}\n\n.library-description-edit:focus {\n    outline: none;\n    border-color: rgba(201, 251, 255, 0.6);\n    box-shadow: 0 0 18px rgba(201, 251, 255, 0.35);\n    background: rgba(0, 20, 40, 1);\n}\n\n.library-description.committed {\n    font-style: normal;\n}\n\n\n\n.submission-message {\n    position: fixed;\n    top: 80px;\n    left: 50%;\n    transform: translateX(-50%);\n    z-index: 9000;\n    \n    font-family: 'Space Grotesk', sans-serif;\n    font-size: 1.1rem;\n    font-weight: 300;\n    text-align: center;\n    letter-spacing: 0.05em;\n    \n    max-width: 800px;\n    width: 90%;\n    padding: 20px 40px;\n    \n    opacity: 0;\n    pointer-events: none;\n    transition: opacity 0.5s ease;\n}\n\n.submission-message.visible {\n    opacity: 1;\n}\n\n.submission-message.error {\n    color: #ff6b6b;\n    text-shadow: 0 0 10px rgba(255, 107, 107, 0.3);\n}\n\n.submission-message.success {\n    color: #53d3c0;\n    text-shadow: 0 0 10px rgba(83, 211, 192, 0.3);\n}\n\n/* Responsive */\n@media (max-width: 768px) {\n    .submission-message {\n        font-size: 1rem;\n        padding: 15px 25px;\n        top: 60px;\n    }\n}\n\n/* Tutorial Message Overlay - Simple text on top */\n\n/* Remove the entire .tutorial-message-overlay section (lines ~1750-1790) */\n\n/* Add new hamburger hover message styles */\n.hamburger-hover-message {\n    position: fixed;\n    bottom: 40px;\n    left: 50%;\n    transform: translateX(-50%);\n    z-index: 2900;\n    \n    font-family: 'Space Grotesk', sans-serif;\n    font-size: 0.9rem;\n    font-weight: 100;\n    color: #C9FBFF;\n    text-align: center;\n    letter-spacing: 0.05em;\n    \n    max-width: 100%; /* CHANGED: Wider for continuous text */\n    width: 100%;\n    padding: 0; /* REMOVED: No padding */\n    \n    background: transparent; /* REMOVED: No background */\n    border: none; /* REMOVED: No border */\n    border-radius: 0; /* REMOVED: No border radius */\n    backdrop-filter: none; /* REMOVED: No blur */\n    -webkit-backdrop-filter: none;\n    \n    text-shadow: 0 0 8px rgba(201, 251, 255, 0.3);\n    box-shadow: none; /* REMOVED: No box shadow */\n    \n    opacity: 0;\n    pointer-events: none;\n    transition: opacity 0.4s ease; /* CHANGED: Smooth fade in/out */\n    \n    white-space: nowrap; /* ADDED: No line breaks */\n    overflow: hidden; /* ADDED: Hide overflow */\n    text-overflow: ellipsis; /* ADDED: ... if too long */\n}\n\n.hamburger-hover-message.visible {\n    opacity: 1;\n}\n\n/* Responsive */\n@media (max-width: 768px) {\n    .hamburger-hover-message {\n        font-size: 0.9rem;\n        bottom: 30px;\n        max-width: 90%;\n    }\n}\n\n@media (max-width: 600px) {\n    .hamburger-hover-message {\n        font-size: 0.85rem;\n        white-space: normal; /* CHANGED: Allow wrapping on very small screens */\n        max-width: 95%;\n    }\n}\n\n/* Evolve Reference Scale */\n.evolve-reference-scale {\n    position: fixed;\n    display: none;\n    flex-direction: column;\n    align-items: center;\n    z-index: 1500;\n    pointer-events: none;\n    \n    /* NEW: Animation for appearing */\n    animation: scaleAppear 0.5s ease-out;\n}\n\n/* NEW: Keyframe animation for scale appearing */\n@keyframes scaleAppear {\n    from {\n        opacity: 0;\n        \n    }\n    to {\n        opacity: 1;\n        \n    }\n}\n\n.scale-line {\n    width: 2px;\n    background: linear-gradient(to bottom,\n        rgba(83, 211, 192, 0.85) 0%,\n        rgba(83, 211, 192, 0.6) 50%,\n        rgba(255, 107, 107, 0.7) 100%);\n    box-shadow: 0 0 8px rgba(83, 211, 192, 0.4);\n    flex: 1;\n}\n\n.scale-label {\n    font-family: 'Space Grotesk', sans-serif;\n    font-size: 0.85rem;\n    font-weight: 300;\n    letter-spacing: 0.05em;\n    color: #C9FBFF;\n    text-shadow: 0 0 8px rgba(201, 251, 255, 0.3);\n    margin: 6px 0;\n    white-space: nowrap;\n}\n\n.scale-label-top {\n    color: #53d3c0;\n    text-shadow: 0 0 8px rgba(83, 211, 192, 0.4);\n}\n\n.scale-label-bottom {\n    color: #ff6b6b;\n    text-shadow: 0 0 8px rgba(255, 107, 107, 0.4);\n}\n\n/* Responsive adjustments */\n@media (max-width: 768px) {\n    .evolve-reference-scale {\n        display: none !important; /* Hide on mobile for clarity */\n    }\n}\n\n/* Mode Close Button */\n.mode-close-btn {\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    width: 40px;\n    height: 40px;\n    \n    background: rgba(19, 25, 47, 0.8);\n    border: 1px solid rgba(83, 211, 192, 0.3);\n    border-radius: 50%;\n    \n    font-family: 'Space Grotesk', sans-serif;\n    font-size: 28px;\n    font-weight: 300;\n    color: #C9FBFF;\n    line-height: 1;\n    \n    cursor: pointer;\n    z-index: 10000;\n    \n    display: flex;\n    align-items: center;\n    justify-content: center;\n    \n    transition: all 0.3s ease;\n    box-shadow: 0 0 15px rgba(83, 211, 192, 0.2);\n}\n\n.mode-close-btn:hover {\n    background: rgba(83, 211, 192, 0.15);\n    border-color: #53d3c0;\n    color: #53d3c0;\n    box-shadow: 0 0 20px rgba(83, 211, 192, 0.4);\n    transform: rotate(90deg);\n}\n\n.mode-close-btn:active {\n    transform: rotate(90deg) scale(0.95);\n}\n\n.mode-close-btn.locked {\n    opacity: 0;\n    pointer-events: none;\n    cursor: not-allowed;\n    transform: none !important;\n}\n\n\n`, \"\"]);\n// Exports\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);\n\n\n//# sourceURL=webpack://sound-particle-visualization/./src/styles.css?./node_modules/css-loader/dist/cjs.js");

/***/ }),

/***/ "./src/audio/SurroundController.js":
/*!*****************************************!*\
  !*** ./src/audio/SurroundController.js ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SurroundController: () => (/* binding */ SurroundController)\n/* harmony export */ });\n/* harmony import */ var three__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! three */ \"./node_modules/three/build/three.module.js\");\n/* harmony import */ var _surround_sound_context_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./surround-sound-context.js */ \"./src/audio/surround-sound-context.js\");\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _regeneratorRuntime() { \"use strict\"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = \"function\" == typeof Symbol ? Symbol : {}, a = i.iterator || \"@@iterator\", c = i.asyncIterator || \"@@asyncIterator\", u = i.toStringTag || \"@@toStringTag\"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, \"\"); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, \"_invoke\", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: \"normal\", arg: t.call(e, r) }; } catch (t) { return { type: \"throw\", arg: t }; } } e.wrap = wrap; var h = \"suspendedStart\", l = \"suspendedYield\", f = \"executing\", s = \"completed\", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { [\"next\", \"throw\", \"return\"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if (\"throw\" !== c.type) { var u = c.arg, h = u.value; return h && \"object\" == _typeof(h) && n.call(h, \"__await\") ? e.resolve(h.__await).then(function (t) { invoke(\"next\", t, i, a); }, function (t) { invoke(\"throw\", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke(\"throw\", t, i, a); }); } a(c.arg); } var r; o(this, \"_invoke\", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error(\"Generator is already running\"); if (o === s) { if (\"throw\" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if (\"next\" === n.method) n.sent = n._sent = n.arg;else if (\"throw\" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else \"return\" === n.method && n.abrupt(\"return\", n.arg); o = f; var p = tryCatch(e, r, n); if (\"normal\" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } \"throw\" === p.type && (o = s, n.method = \"throw\", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, \"throw\" === n && e.iterator[\"return\"] && (r.method = \"return\", r.arg = t, maybeInvokeDelegate(e, r), \"throw\" === r.method) || \"return\" !== n && (r.method = \"throw\", r.arg = new TypeError(\"The iterator does not provide a '\" + n + \"' method\")), y; var i = tryCatch(o, e.iterator, r.arg); if (\"throw\" === i.type) return r.method = \"throw\", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, \"return\" !== r.method && (r.method = \"next\", r.arg = t), r.delegate = null, y) : a : (r.method = \"throw\", r.arg = new TypeError(\"iterator result is not an object\"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = \"normal\", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: \"root\" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || \"\" === e) { var r = e[a]; if (r) return r.call(e); if (\"function\" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(_typeof(e) + \" is not iterable\"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, \"constructor\", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, \"constructor\", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, \"GeneratorFunction\"), e.isGeneratorFunction = function (t) { var e = \"function\" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || \"GeneratorFunction\" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, \"GeneratorFunction\")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, \"Generator\"), define(g, a, function () { return this; }), define(g, \"toString\", function () { return \"[object Generator]\"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) \"t\" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if (\"throw\" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = \"throw\", a.arg = e, r.next = n, o && (r.method = \"next\", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if (\"root\" === i.tryLoc) return handle(\"end\"); if (i.tryLoc <= this.prev) { var c = n.call(i, \"catchLoc\"), u = n.call(i, \"finallyLoc\"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error(\"try statement without catch or finally\"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, \"finallyLoc\") && this.prev < o.finallyLoc) { var i = o; break; } } i && (\"break\" === t || \"continue\" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = \"next\", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if (\"throw\" === t.type) throw t.arg; return \"break\" === t.type || \"continue\" === t.type ? this.next = t.arg : \"return\" === t.type ? (this.rval = this.arg = t.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, \"catch\": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if (\"throw\" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error(\"illegal catch attempt\"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, \"next\" === this.method && (this.arg = t), y; } }, e; }\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nfunction _slicedToArray(r, e) { return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(r) { if (Array.isArray(r)) return r; }\nfunction _createForOfIteratorHelper(r, e) { var t = \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && \"number\" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t[\"return\"] || t[\"return\"](); } finally { if (u) throw o; } } }; }\nfunction _unsupportedIterableToArray(r, a) { if (r) { if (\"string\" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }\nfunction _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }\nfunction _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\"); }\nfunction _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }\nfunction _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", { writable: !1 }), e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\n\n\nvar SurroundController = /*#__PURE__*/function () {\n  function SurroundController() {\n    var roomWidth = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 50;\n    var roomHeight = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 70;\n    var roomDepth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 50;\n    _classCallCheck(this, SurroundController);\n    this.ctx = new _surround_sound_context_js__WEBPACK_IMPORTED_MODULE_0__.SurroundContext(window, roomWidth, roomHeight, roomDepth);\n    this.audioContext = this.ctx.audioContext;\n    this.sources = new Map();\n    this.particleSystem = null;\n    this.camera = null;\n    this.currentMode = 'main';\n    this._seqActive = false;\n    this._seqIdx = 0;\n    this._seqGapMs = 5000;\n    this._seqTimer = null;\n    this._currentId = null;\n    this._dragPlayingIds = new Set();\n    this._activeOneShotId = null;\n    this._highlighted = new Map();\n    this._highlightRoots = new Set();\n    this._highlightById = new Map();\n    this._autoHighlightedIds = new Set();\n    this.sequenceFadeInMs = 450;\n    this.sequenceFadeOutMs = 800;\n    this._userRequestedPlay = false;\n    this._activeOneShotIds = new Set();\n\n    // ADDED: Store pending solutions for reloading when mode changes\n    this._pendingSolutions = null;\n\n    // ADDED: Store last sequence index to resume from same position\n    this._lastSeqIdx = 0;\n\n    // Animation loop for updating positions and listener\n    this._animationFrameId = null;\n    this._startPositionUpdateLoop();\n    console.log(\"\\uD83C\\uDFB5 SurroundController initialized with Web Audio 3D spatialization\");\n  }\n  return _createClass(SurroundController, [{\n    key: \"setCamera\",\n    value: function setCamera(camera) {\n      this.camera = camera;\n      console.log(\"\\uD83C\\uDFA5 Camera set for audio listener tracking\");\n      if (this.camera) {\n        this._updateListenerFromCamera();\n      }\n    }\n  }, {\n    key: \"_updateListenerFromCamera\",\n    value: function _updateListenerFromCamera() {\n      if (!this.camera) return;\n      this.ctx.setListenerPosition(this.camera.position.x, this.camera.position.y, this.camera.position.z);\n      var cameraDirection = new three__WEBPACK_IMPORTED_MODULE_1__.Vector3();\n      this.camera.getWorldDirection(cameraDirection);\n      var cameraUp = new three__WEBPACK_IMPORTED_MODULE_1__.Vector3(0, 1, 0);\n      cameraUp.applyQuaternion(this.camera.quaternion);\n      this.ctx.setListenerOrientation(cameraDirection.x, cameraDirection.y, cameraDirection.z, cameraUp.x, cameraUp.y, cameraUp.z);\n    }\n  }, {\n    key: \"_startPositionUpdateLoop\",\n    value: function _startPositionUpdateLoop() {\n      var _this = this;\n      var _update = function update() {\n        _this._updateListenerFromCamera();\n        var _iterator = _createForOfIteratorHelper(_this.sources),\n          _step;\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var _sourceData$spatialSo, _sourceData$spatialSo2;\n            var _step$value = _slicedToArray(_step.value, 2),\n              id = _step$value[0],\n              sourceData = _step$value[1];\n            if ((_sourceData$spatialSo = sourceData.spatialSource) !== null && _sourceData$spatialSo !== void 0 && _sourceData$spatialSo.isPlaying && (_sourceData$spatialSo2 = sourceData.spatialSource) !== null && _sourceData$spatialSo2 !== void 0 && _sourceData$spatialSo2.isSpatial) {\n              var solid = _this._getSolidRootForId(id);\n              if (solid) {\n                sourceData.spatialSource.setPosition(solid.position.x, solid.position.y, solid.position.z);\n              }\n            }\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n        _this._animationFrameId = requestAnimationFrame(_update);\n      };\n      this._animationFrameId = requestAnimationFrame(_update);\n    }\n  }, {\n    key: \"setParticleSystem\",\n    value: function setParticleSystem(particleSystem) {\n      this.particleSystem = particleSystem;\n      if (this.particleSystem) this.particleSystem.surroundController = this;\n    }\n  }, {\n    key: \"_getSolidRootForId\",\n    value: function _getSolidRootForId(id) {\n      var _this$particleSystem$, _this$particleSystem;\n      if (!this.particleSystem) return null;\n      var solids = ((_this$particleSystem$ = (_this$particleSystem = this.particleSystem).getSolids) === null || _this$particleSystem$ === void 0 ? void 0 : _this$particleSystem$.call(_this$particleSystem)) || [];\n      var _iterator2 = _createForOfIteratorHelper(solids),\n        _step2;\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var _s$userData;\n          var s = _step2.value;\n          if ((s === null || s === void 0 || (_s$userData = s.userData) === null || _s$userData === void 0 || (_s$userData = _s$userData.solution) === null || _s$userData === void 0 ? void 0 : _s$userData.id) === id) return s;\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n      return null;\n    }\n  }, {\n    key: \"loadAll\",\n    value: function () {\n      var _loadAll = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(solutions) {\n        var _this2 = this;\n        var _iterator3, _step3, _step3$value, id, sourceData, useSpatial, _iterator4, _step4, _loop;\n        return _regeneratorRuntime().wrap(function _callee$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              // ADDED: Store solutions for potential reload\n              this._pendingSolutions = solutions;\n\n              // Dispose old sources properly\n              _iterator3 = _createForOfIteratorHelper(this.sources);\n              try {\n                for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n                  _step3$value = _slicedToArray(_step3.value, 2), id = _step3$value[0], sourceData = _step3$value[1];\n                  try {\n                    if (sourceData.spatialSource) {\n                      sourceData.spatialSource.dispose();\n                    }\n                  } catch (e) {\n                    console.warn(\"Error disposing source \".concat(id, \":\"), e);\n                  }\n                }\n              } catch (err) {\n                _iterator3.e(err);\n              } finally {\n                _iterator3.f();\n              }\n              this.sources.clear();\n\n              // Determine if we should use spatial audio based on mode\n              useSpatial = this.currentMode === 'main';\n              console.log(\"\\uD83D\\uDD04 Loading audio for \".concat(solutions.length, \" solutions (mode: \").concat(this.currentMode, \", spatial: \").concat(useSpatial, \")\"));\n              _iterator4 = _createForOfIteratorHelper(solutions);\n              _context2.prev = 7;\n              _loop = /*#__PURE__*/_regeneratorRuntime().mark(function _loop() {\n                var s, rawBuffer, decodedBuffer, solid, initialPos, spatialSource;\n                return _regeneratorRuntime().wrap(function _loop$(_context) {\n                  while (1) switch (_context.prev = _context.next) {\n                    case 0:\n                      s = _step4.value;\n                      if (!(s.audio && s.audio.data)) {\n                        _context.next = 21;\n                        break;\n                      }\n                      _context.prev = 2;\n                      _context.next = 5;\n                      return _this2._decodeBase64ToBuffer(s.audio.data);\n                    case 5:\n                      rawBuffer = _context.sent;\n                      _context.next = 8;\n                      return new Promise(function (resolve, reject) {\n                        _this2.audioContext.decodeAudioData(rawBuffer.slice(0), resolve, reject);\n                      });\n                    case 8:\n                      decodedBuffer = _context.sent;\n                      solid = _this2._getSolidRootForId(s.id);\n                      initialPos = solid ? solid.position : {\n                        x: 0,\n                        y: 0,\n                        z: 0\n                      }; // Create spatial or stereo source based on mode\n                      spatialSource = _this2.ctx.createSource(initialPos.x, initialPos.y, initialPos.z, useSpatial);\n                      spatialSource.setBuffer(decodedBuffer);\n                      if (useSpatial) {\n                        // Configure spatial audio parameters for main mode\n                        spatialSource.setDistanceModel('linear');\n                        spatialSource.setRefDistance(1);\n                        spatialSource.setMaxDistance(_this2.ctx.longestSide * 2);\n                        spatialSource.setRolloffFactor(10);\n                      }\n                      _this2.sources.set(s.id, {\n                        spatialSource: spatialSource,\n                        buffer: decodedBuffer,\n                        targetGain: 1.0\n                      });\n                      console.log(\"\\u2705 Loaded source \".concat(s.id, \" (\").concat(useSpatial ? 'spatial 3D' : 'stereo', \")\"));\n                      _context.next = 21;\n                      break;\n                    case 18:\n                      _context.prev = 18;\n                      _context.t0 = _context[\"catch\"](2);\n                      console.error(\"\\u274C Failed to load source \".concat(s.id, \":\"), _context.t0);\n                    case 21:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }, _loop, null, [[2, 18]]);\n              });\n              _iterator4.s();\n            case 10:\n              if ((_step4 = _iterator4.n()).done) {\n                _context2.next = 14;\n                break;\n              }\n              return _context2.delegateYield(_loop(), \"t0\", 12);\n            case 12:\n              _context2.next = 10;\n              break;\n            case 14:\n              _context2.next = 19;\n              break;\n            case 16:\n              _context2.prev = 16;\n              _context2.t1 = _context2[\"catch\"](7);\n              _iterator4.e(_context2.t1);\n            case 19:\n              _context2.prev = 19;\n              _iterator4.f();\n              return _context2.finish(19);\n            case 22:\n              console.log(\"[SurroundController] Loaded \".concat(this.sources.size, \" sources (mode: \").concat(this.currentMode, \").\"));\n            case 23:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee, this, [[7, 16, 19, 22]]);\n      }));\n      function loadAll(_x) {\n        return _loadAll.apply(this, arguments);\n      }\n      return loadAll;\n    }()\n  }, {\n    key: \"_playSource\",\n    value: function _playSource(sourceData) {\n      if (!(sourceData !== null && sourceData !== void 0 && sourceData.spatialSource)) return;\n      sourceData.spatialSource.setLoop(sourceData.shouldLoop || false);\n      sourceData.spatialSource.play();\n    }\n  }, {\n    key: \"_stopSource\",\n    value: function _stopSource(sourceData) {\n      var fadeOut = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      if (!(sourceData !== null && sourceData !== void 0 && sourceData.spatialSource)) return;\n      if (fadeOut) {\n        // IMPROVED: Use mode-specific fade duration\n        var fadeDuration = this.currentMode === 'main' ? this.sequenceFadeOutMs : 400;\n        sourceData.spatialSource.fadeOut(fadeDuration);\n      } else {\n        // Immediate stop for UI modes when explicitly requested\n        sourceData.spatialSource.stop();\n      }\n    }\n  }, {\n    key: \"_isSourcePlaying\",\n    value: function _isSourcePlaying(sourceData) {\n      var _sourceData$spatialSo3;\n      return (sourceData === null || sourceData === void 0 || (_sourceData$spatialSo3 = sourceData.spatialSource) === null || _sourceData$spatialSo3 === void 0 ? void 0 : _sourceData$spatialSo3.isPlaying) || false;\n    }\n  }, {\n    key: \"_setSourceVolume\",\n    value: function _setSourceVolume(sourceData, volume) {\n      if (!(sourceData !== null && sourceData !== void 0 && sourceData.spatialSource)) return;\n      sourceData.spatialSource.setGain(volume);\n    }\n  }, {\n    key: \"_getSourceVolume\",\n    value: function _getSourceVolume(sourceData) {\n      var _sourceData$spatialSo4;\n      return (sourceData === null || sourceData === void 0 || (_sourceData$spatialSo4 = sourceData.spatialSource) === null || _sourceData$spatialSo4 === void 0 ? void 0 : _sourceData$spatialSo4.getGain()) || 0;\n    }\n  }, {\n    key: \"setMode\",\n    value: function () {\n      var _setMode = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(mode) {\n        var previousMode, needsReload;\n        return _regeneratorRuntime().wrap(function _callee2$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              previousMode = this.currentMode;\n              this.currentMode = mode;\n              console.log(\"\\uD83C\\uDF9A\\uFE0F Audio mode: \".concat(previousMode, \" -> \").concat(mode));\n\n              // FIXED: Always reload when switching to/from main mode\n              needsReload = previousMode !== mode && (previousMode === 'main' || mode === 'main');\n              if (!(needsReload && this._pendingSolutions)) {\n                _context3.next = 8;\n                break;\n              }\n              console.log(\"\\uD83D\\uDD04 Mode switch \".concat(previousMode, \" -> \").concat(mode, \" requires audio reload - reloading sources...\"));\n              _context3.next = 8;\n              return this.loadAll(this._pendingSolutions);\n            case 8:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee2, this);\n      }));\n      function setMode(_x2) {\n        return _setMode.apply(this, arguments);\n      }\n      return setMode;\n    }()\n  }, {\n    key: \"playOnly\",\n    value: function () {\n      var _playOnly = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(id) {\n        var opts,\n          _args4 = arguments;\n        return _regeneratorRuntime().wrap(function _callee3$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              opts = _args4.length > 1 && _args4[1] !== undefined ? _args4[1] : {};\n              if (!this._seqActive) {\n                _context4.next = 3;\n                break;\n              }\n              return _context4.abrupt(\"return\");\n            case 3:\n              if (this.sources.has(id)) {\n                _context4.next = 5;\n                break;\n              }\n              return _context4.abrupt(\"return\");\n            case 5:\n              this.stopSequential();\n              _context4.next = 8;\n              return this.fadeOutAll(200);\n            case 8:\n              this._highlightSource(id);\n              this._updateSolidPosition(id);\n              _context4.next = 12;\n              return this._playId(id, {\n                loop: false,\n                reset: true,\n                autoHighlight: true\n              });\n            case 12:\n              console.log(\"[SurroundController] \\u25B6\\uFE0F Playing only source \".concat(id));\n            case 13:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee3, this);\n      }));\n      function playOnly(_x3) {\n        return _playOnly.apply(this, arguments);\n      }\n      return playOnly;\n    }()\n  }, {\n    key: \"playAll\",\n    value: function () {\n      var _playAll = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        var gapSeconds,\n          options,\n          userInitiated,\n          force,\n          _args5 = arguments;\n        return _regeneratorRuntime().wrap(function _callee4$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              gapSeconds = _args5.length > 0 && _args5[0] !== undefined ? _args5[0] : 5;\n              options = _args5.length > 1 && _args5[1] !== undefined ? _args5[1] : {};\n              userInitiated = false;\n              force = false;\n              if (typeof options === 'boolean') {\n                userInitiated = options;\n              } else if (options && _typeof(options) === 'object') {\n                userInitiated = !!options.userInitiated;\n                force = !!options.force;\n              }\n              if (userInitiated) {\n                this._userRequestedPlay = true;\n              }\n              if (!(!this._userRequestedPlay && !force)) {\n                _context5.next = 8;\n                break;\n              }\n              return _context5.abrupt(\"return\");\n            case 8:\n              if (!(this.audioContext.state === 'suspended')) {\n                _context5.next = 11;\n                break;\n              }\n              _context5.next = 11;\n              return this.audioContext.resume();\n            case 11:\n              // FIXED: Resume from last index instead of starting from 0\n              this.startSequential(gapSeconds, true); // Pass resume flag\n              this._emitPlaybackState(true);\n            case 13:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee4, this);\n      }));\n      function playAll() {\n        return _playAll.apply(this, arguments);\n      }\n      return playAll;\n    }()\n  }, {\n    key: \"stopAll\",\n    value: function stopAll() {\n      if (this._animationFrameId) {\n        cancelAnimationFrame(this._animationFrameId);\n      }\n      this.stopSequential();\n      var _iterator5 = _createForOfIteratorHelper(this.sources.entries()),\n        _step5;\n      try {\n        for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n          var _step5$value = _slicedToArray(_step5.value, 2),\n            id = _step5$value[0],\n            sourceData = _step5$value[1];\n          try {\n            this._stopSource(sourceData, false);\n          } catch (e) {\n            console.warn(\"Error stopping source \".concat(id, \":\"), e);\n          }\n        }\n      } catch (err) {\n        _iterator5.e(err);\n      } finally {\n        _iterator5.f();\n      }\n      if (this.sources.size > 0) {\n        console.log(\"[SurroundController] \\u23F9\\uFE0F Stopped all sources.\");\n      }\n      this._dragPlayingIds.clear();\n      this._activeOneShotId = null;\n      this._userRequestedPlay = false;\n      this._emitPlaybackState(false);\n      this._startPositionUpdateLoop();\n    }\n  }, {\n    key: \"fadeOutAll\",\n    value: function () {\n      var _fadeOutAll = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        var ms,\n          pauseAfter,\n          tasks,\n          _iterator6,\n          _step6,\n          _step6$value,\n          id,\n          _args6 = arguments;\n        return _regeneratorRuntime().wrap(function _callee5$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              ms = _args6.length > 0 && _args6[0] !== undefined ? _args6[0] : 400;\n              pauseAfter = _args6.length > 1 && _args6[1] !== undefined ? _args6[1] : true;\n              tasks = [];\n              _iterator6 = _createForOfIteratorHelper(this.sources);\n              try {\n                for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {\n                  _step6$value = _slicedToArray(_step6.value, 1), id = _step6$value[0];\n                  tasks.push(this._fadeToZero(id, ms, pauseAfter));\n                }\n              } catch (err) {\n                _iterator6.e(err);\n              } finally {\n                _iterator6.f();\n              }\n              _context6.next = 7;\n              return Promise.all(tasks);\n            case 7:\n              if (pauseAfter) {\n                this._activeOneShotId = null;\n              }\n            case 8:\n            case \"end\":\n              return _context6.stop();\n          }\n        }, _callee5, this);\n      }));\n      function fadeOutAll() {\n        return _fadeOutAll.apply(this, arguments);\n      }\n      return fadeOutAll;\n    }()\n  }, {\n    key: \"_fadeToZero\",\n    value: function () {\n      var _fadeToZero2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(id) {\n        var _this3 = this;\n        var fadeMs,\n          pauseAfter,\n          s,\n          startVolume,\n          startTime,\n          _args7 = arguments;\n        return _regeneratorRuntime().wrap(function _callee6$(_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              fadeMs = _args7.length > 1 && _args7[1] !== undefined ? _args7[1] : 200;\n              pauseAfter = _args7.length > 2 && _args7[2] !== undefined ? _args7[2] : true;\n              s = this.sources.get(id);\n              if (s) {\n                _context7.next = 5;\n                break;\n              }\n              return _context7.abrupt(\"return\");\n            case 5:\n              startVolume = this._getSourceVolume(s);\n              startTime = Date.now();\n              return _context7.abrupt(\"return\", new Promise(function (resolve) {\n                var _fade = function fade() {\n                  var elapsed = Date.now() - startTime;\n                  var progress = Math.min(elapsed / fadeMs, 1);\n                  var volume = startVolume * (1 - progress);\n                  _this3._setSourceVolume(s, volume);\n                  if (progress < 1) {\n                    requestAnimationFrame(_fade);\n                  } else {\n                    if (pauseAfter && _this3._isSourcePlaying(s)) {\n                      try {\n                        _this3._stopSource(s, false);\n                      } catch (_unused) {}\n                    }\n                    resolve();\n                  }\n                };\n                _fade();\n              }));\n            case 8:\n            case \"end\":\n              return _context7.stop();\n          }\n        }, _callee6, this);\n      }));\n      function _fadeToZero(_x4) {\n        return _fadeToZero2.apply(this, arguments);\n      }\n      return _fadeToZero;\n    }()\n  }, {\n    key: \"playLoopForMesh\",\n    value: function () {\n      var _playLoopForMesh = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(id, meshRoot) {\n        var opts,\n          root,\n          _args8 = arguments;\n        return _regeneratorRuntime().wrap(function _callee7$(_context8) {\n          while (1) switch (_context8.prev = _context8.next) {\n            case 0:\n              opts = _args8.length > 2 && _args8[2] !== undefined ? _args8[2] : {};\n              if (!this._seqActive) {\n                _context8.next = 3;\n                break;\n              }\n              return _context8.abrupt(\"return\");\n            case 3:\n              if (this.sources.has(id)) {\n                _context8.next = 5;\n                break;\n              }\n              return _context8.abrupt(\"return\");\n            case 5:\n              _context8.next = 7;\n              return this.stopAllManualPlayback();\n            case 7:\n              root = meshRoot || this._getSolidRootForId(id);\n              if (root) {\n                this._applyGreenOutline(root);\n                this._highlightById.set(id, root);\n              }\n              this._updateSolidPosition(id);\n              _context8.next = 12;\n              return this._playId(id, {\n                loop: true,\n                reset: true,\n                autoHighlight: !!root\n              });\n            case 12:\n              this._dragPlayingIds.add(id);\n              this._activeOneShotId = null;\n            case 14:\n            case \"end\":\n              return _context8.stop();\n          }\n        }, _callee7, this);\n      }));\n      function playLoopForMesh(_x5, _x6) {\n        return _playLoopForMesh.apply(this, arguments);\n      }\n      return playLoopForMesh;\n    }()\n  }, {\n    key: \"playOneShot\",\n    value: function () {\n      var _playOneShot = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8(id) {\n        var _this4 = this;\n        var _ref,\n          _ref$highlightMesh,\n          highlightMesh,\n          _ref$onEnded,\n          onEnded,\n          _ref$allowOverlap,\n          allowOverlap,\n          currentSource,\n          root,\n          s,\n          playbackToken,\n          _checkEnded,\n          _args9 = arguments;\n        return _regeneratorRuntime().wrap(function _callee8$(_context9) {\n          while (1) switch (_context9.prev = _context9.next) {\n            case 0:\n              _ref = _args9.length > 1 && _args9[1] !== undefined ? _args9[1] : {}, _ref$highlightMesh = _ref.highlightMesh, highlightMesh = _ref$highlightMesh === void 0 ? null : _ref$highlightMesh, _ref$onEnded = _ref.onEnded, onEnded = _ref$onEnded === void 0 ? null : _ref$onEnded, _ref$allowOverlap = _ref.allowOverlap, allowOverlap = _ref$allowOverlap === void 0 ? false : _ref$allowOverlap;\n              if (this.sources.has(id)) {\n                _context9.next = 3;\n                break;\n              }\n              return _context9.abrupt(\"return\");\n            case 3:\n              console.log(\"\\uD83C\\uDFB5 playOneShot called for \".concat(id));\n\n              // FIXED: Stop all other playback INCLUDING sequential sounds\n              if (allowOverlap) {\n                _context9.next = 8;\n                break;\n              }\n              _context9.next = 7;\n              return this._stopOtherManualPlayback(id);\n            case 7:\n              // ADDED: Also stop any active sequential sound\n              if (this._currentId != null && this._currentId !== id) {\n                currentSource = this.sources.get(this._currentId);\n                if (currentSource && this._isSourcePlaying(currentSource)) {\n                  console.log(\"   Stopping active sequential sound: \".concat(this._currentId));\n                  this._stopSource(currentSource, true); // Fade out\n                  this._unhighlightSource(this._currentId);\n                }\n              }\n            case 8:\n              // Apply highlight\n              root = highlightMesh;\n              if (!root) {\n                this._highlightSource(id);\n                root = this._highlightById.get(id);\n              } else {\n                // FIXED: Clear any existing highlight on this root first\n                if (this._highlighted.has(root)) {\n                  this._clearGreenOutline(root);\n                }\n                this._applyGreenOutline(root);\n                this._highlightById.set(id, root);\n              }\n              s = this.sources.get(id); // NEW: token to ignore stale callbacks when restarting same one-shot\n              playbackToken = s._oneShotToken = (s._oneShotToken || 0) + 1;\n              _checkEnded = function checkEnded() {\n                if (s._oneShotToken !== playbackToken) return; // superseded by newer playback\n\n                var now = performance.now();\n                if (s._lastStartTime && now - s._lastStartTime < 160) {\n                  requestAnimationFrame(_checkEnded);\n                  return;\n                }\n                if (!_this4._isSourcePlaying(s)) {\n                  console.log(\"   Sound \".concat(id, \" finished playing\"));\n                  if (_this4._autoHighlightedIds.has(id) || highlightMesh) {\n                    _this4._unhighlightSource(id);\n                  }\n                  if (_this4._activeOneShotId === id) {\n                    _this4._activeOneShotId = null;\n                  }\n                  if (typeof onEnded === 'function') {\n                    console.log(\"\\uD83C\\uDFB5 Calling onEnded callback for \".concat(id));\n                    setTimeout(function () {\n                      return onEnded();\n                    }, 100);\n                  }\n                } else {\n                  requestAnimationFrame(_checkEnded);\n                }\n              };\n              this._updateSolidPosition(id);\n\n              // FIXED: Resume AudioContext if suspended (for initial clicks without soundscape)\n              if (!(this.audioContext.state === 'suspended')) {\n                _context9.next = 18;\n                break;\n              }\n              _context9.next = 17;\n              return this.audioContext.resume();\n            case 17:\n              console.log(' AudioContext resumed for one-shot playback');\n            case 18:\n              _context9.next = 20;\n              return this._playId(id, {\n                loop: false,\n                reset: true,\n                autoHighlight: true\n              });\n            case 20:\n              this._activeOneShotId = id;\n              console.log(\"   One-shot \".concat(id, \" now playing\"));\n              requestAnimationFrame(_checkEnded);\n            case 23:\n            case \"end\":\n              return _context9.stop();\n          }\n        }, _callee8, this);\n      }));\n      function playOneShot(_x7) {\n        return _playOneShot.apply(this, arguments);\n      }\n      return playOneShot;\n    }()\n  }, {\n    key: \"startSequential\",\n    value: function startSequential() {\n      var gapSeconds = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 3;\n      var resume = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      if (!resume) {\n        this.stopSequential();\n        this._seqIdx = 0;\n        this._lastSeqIdx = 0;\n        console.log(' Starting sequential from beginning');\n      } else {\n        if (this._seqTimer) {\n          clearTimeout(this._seqTimer);\n          this._seqTimer = null;\n        }\n        console.log(\"\\uD83D\\uDD04 Resuming sequential from index \".concat(this._lastSeqIdx));\n        this._seqIdx = this._lastSeqIdx;\n      }\n      this._seqGapMs = Math.max(0, gapSeconds * 1000);\n      this._seqActive = true;\n      var _iterator7 = _createForOfIteratorHelper(this.sources),\n        _step7;\n      try {\n        for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {\n          var _step7$value = _slicedToArray(_step7.value, 2),\n            id = _step7$value[0],\n            _s = _step7$value[1];\n          try {\n            this._stopSource(_s, false);\n            this._setSourceVolume(_s, 0);\n            if (_s.targetGain == null) _s.targetGain = 1.0;\n            this._unhighlightSource(id);\n          } catch (_unused2) {}\n        }\n      } catch (err) {\n        _iterator7.e(err);\n      } finally {\n        _iterator7.f();\n      }\n      this.clearAllGreenOutlines();\n      this._playNextInSequence();\n    }\n  }, {\n    key: \"stopSequential\",\n    value: function stopSequential() {\n      if (this._seqActive) {\n        this._lastSeqIdx = this._seqIdx % Math.max(1, this.sources.size);\n      }\n      this._seqActive = false;\n      if (this._seqTimer) {\n        clearTimeout(this._seqTimer);\n        this._seqTimer = null;\n      }\n    }\n  }, {\n    key: \"_playNextInSequence\",\n    value: function _playNextInSequence() {\n      var _this5 = this;\n      if (!this._seqActive || this.sources.size === 0) return;\n      var ids = Array.from(this.sources.keys());\n      if (!ids.length) return;\n      var total = ids.length;\n      var idx = this._seqIdx % total;\n      var nextId = ids[idx];\n      this._lastSeqIdx = (idx + 1) % total;\n      this._seqIdx = this._lastSeqIdx;\n      if (this._currentId && this._currentId !== nextId) {\n        var prev = this.sources.get(this._currentId);\n        if (prev) {\n          try {\n            this._stopSource(prev, this.currentMode === 'main');\n            this._setSourceVolume(prev, 0);\n          } catch (_unused3) {}\n          for (var _i = 0, _Array$from = Array.from(this._autoHighlightedIds); _i < _Array$from.length; _i++) {\n            var oldId = _Array$from[_i];\n            this._unhighlightSource(oldId);\n          }\n        }\n      }\n      this._currentId = nextId;\n\n      // FIXED: Clear old highlights more aggressively\n      for (var _i2 = 0, _Array$from2 = Array.from(this._autoHighlightedIds); _i2 < _Array$from2.length; _i2++) {\n        var _oldId = _Array$from2[_i2];\n        if (_oldId !== nextId) this._unhighlightSource(_oldId);\n      }\n\n      // FIXED: Force clear all green outlines before applying new one\n      this.clearAllGreenOutlines();\n\n      // FIXED: Apply highlight with a small delay to ensure cleanup completed\n      requestAnimationFrame(function () {\n        _this5._highlightSource(nextId);\n        _this5._updateSolidPosition(nextId);\n      });\n      var s = this.sources.get(nextId);\n      if (!s) return;\n      try {\n        var _s$targetGain;\n        s.shouldLoop = false;\n        this._setSourceVolume(s, 0);\n        this._playSource(s);\n        this._fadeVolume(s, (_s$targetGain = s.targetGain) !== null && _s$targetGain !== void 0 ? _s$targetGain : 1.0, this.sequenceFadeInMs);\n        var _checkEnd = function checkEnd() {\n          if (!_this5._isSourcePlaying(s)) {\n            _this5._unhighlightSource(nextId);\n            _this5._seqTimer = setTimeout(function () {\n              return _this5._playNextInSequence();\n            }, _this5._seqGapMs);\n          } else if (_this5._seqActive) {\n            requestAnimationFrame(_checkEnd);\n          }\n        };\n        requestAnimationFrame(_checkEnd);\n      } catch (error) {\n        console.error('Failed to play in sequence:', error);\n        this._unhighlightSource(nextId);\n        this._seqTimer = setTimeout(function () {\n          return _this5._playNextInSequence();\n        }, this._seqGapMs);\n      }\n    }\n  }, {\n    key: \"_fadeVolume\",\n    value: function () {\n      var _fadeVolume2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee9(sourceData, targetVolume) {\n        var _this6 = this;\n        var ms,\n          startVolume,\n          startTime,\n          _args10 = arguments;\n        return _regeneratorRuntime().wrap(function _callee9$(_context10) {\n          while (1) switch (_context10.prev = _context10.next) {\n            case 0:\n              ms = _args10.length > 2 && _args10[2] !== undefined ? _args10[2] : 200;\n              if (sourceData) {\n                _context10.next = 3;\n                break;\n              }\n              return _context10.abrupt(\"return\");\n            case 3:\n              startVolume = this._getSourceVolume(sourceData);\n              startTime = Date.now();\n              return _context10.abrupt(\"return\", new Promise(function (resolve) {\n                var _fade2 = function fade() {\n                  var elapsed = Date.now() - startTime;\n                  var progress = Math.min(elapsed / ms, 1);\n                  var volume = startVolume + (targetVolume - startVolume) * progress;\n                  _this6._setSourceVolume(sourceData, volume);\n                  if (progress < 1) {\n                    requestAnimationFrame(_fade2);\n                  } else {\n                    resolve();\n                  }\n                };\n                _fade2();\n              }));\n            case 6:\n            case \"end\":\n              return _context10.stop();\n          }\n        }, _callee9, this);\n      }));\n      function _fadeVolume(_x8, _x9) {\n        return _fadeVolume2.apply(this, arguments);\n      }\n      return _fadeVolume;\n    }()\n  }, {\n    key: \"_playId\",\n    value: function () {\n      var _playId2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee10(id) {\n        var _this7 = this;\n        var _ref2,\n          _ref2$loop,\n          loop,\n          _ref2$reset,\n          reset,\n          _ref2$autoHighlight,\n          autoHighlight,\n          s,\n          _s$targetGain2,\n          _checkEnd2,\n          _args11 = arguments;\n        return _regeneratorRuntime().wrap(function _callee10$(_context11) {\n          while (1) switch (_context11.prev = _context11.next) {\n            case 0:\n              _ref2 = _args11.length > 1 && _args11[1] !== undefined ? _args11[1] : {}, _ref2$loop = _ref2.loop, loop = _ref2$loop === void 0 ? false : _ref2$loop, _ref2$reset = _ref2.reset, reset = _ref2$reset === void 0 ? true : _ref2$reset, _ref2$autoHighlight = _ref2.autoHighlight, autoHighlight = _ref2$autoHighlight === void 0 ? false : _ref2$autoHighlight;\n              s = this.sources.get(id);\n              if (s) {\n                _context11.next = 4;\n                break;\n              }\n              return _context11.abrupt(\"return\");\n            case 4:\n              _context11.prev = 4;\n              if (reset && this._isSourcePlaying(s)) {\n                this._stopSource(s, false);\n              }\n              s.shouldLoop = !!loop;\n              this._setSourceVolume(s, 0);\n              s._lastStartTime = performance.now();\n              this._playSource(s);\n              _context11.next = 12;\n              return this._fadeVolume(s, (_s$targetGain2 = s.targetGain) !== null && _s$targetGain2 !== void 0 ? _s$targetGain2 : 1.0, 250);\n            case 12:\n              if (autoHighlight && !loop) {\n                _checkEnd2 = function checkEnd() {\n                  if (!_this7._isSourcePlaying(s)) {\n                    _this7._unhighlightSource(id);\n                  } else {\n                    requestAnimationFrame(_checkEnd2);\n                  }\n                };\n                requestAnimationFrame(_checkEnd2);\n              }\n              _context11.next = 18;\n              break;\n            case 15:\n              _context11.prev = 15;\n              _context11.t0 = _context11[\"catch\"](4);\n              console.error(\"Failed to play \".concat(id, \":\"), _context11.t0);\n            case 18:\n            case \"end\":\n              return _context11.stop();\n          }\n        }, _callee10, this, [[4, 15]]);\n      }));\n      function _playId(_x10) {\n        return _playId2.apply(this, arguments);\n      }\n      return _playId;\n    }()\n  }, {\n    key: \"_updateSolidPosition\",\n    value: function _updateSolidPosition(id) {\n      var solid = this._getSolidRootForId(id);\n      var s = this.sources.get(id);\n      if (solid && s !== null && s !== void 0 && s.spatialSource && s.spatialSource.isSpatial) {\n        s.spatialSource.setPosition(solid.position.x, solid.position.y, solid.position.z);\n      }\n    }\n  }, {\n    key: \"_highlightSource\",\n    value: function _highlightSource(id) {\n      // FIXED: Force clear if already highlighted\n      if (this._highlightById.has(id)) {\n        this._unhighlightSource(id);\n      }\n      var root = this._getSolidRootForId(id);\n      if (!root) {\n        console.warn(\"\\u26A0\\uFE0F No solid found for id \".concat(id));\n        return;\n      }\n      console.log(\"\\u2728 Highlighting source \".concat(id));\n      this._applyGreenOutline(root);\n      this._highlightById.set(id, root);\n      this._autoHighlightedIds.add(id);\n    }\n  }, {\n    key: \"_unhighlightSource\",\n    value: function _unhighlightSource(id) {\n      if (!this._highlightById.has(id)) return;\n      console.log(\"\\uD83D\\uDD32 Unhighlighting source \".concat(id));\n      var root = this._highlightById.get(id);\n      this._clearGreenOutline(root);\n      this._highlightById[\"delete\"](id);\n      this._autoHighlightedIds[\"delete\"](id);\n    }\n  }, {\n    key: \"_applyGreenOutline\",\n    value: function _applyGreenOutline(root) {\n      // FIXED: Force clear existing highlight first\n      if (this._highlighted.has(root)) {\n        this._clearGreenOutline(root);\n      }\n      if (!root) return;\n      var highlightColor = new three__WEBPACK_IMPORTED_MODULE_1__.Color(0x53d3c0);\n      var originals = [];\n      root.traverse(function (child) {\n        if (!child.isMesh) return;\n        var baseMat = child.material;\n        if (!baseMat) return;\n\n        // FIXED: Always store fresh original reference\n        if (!child.userData.__surroundOriginalMaterial) {\n          child.userData.__surroundOriginalMaterial = baseMat;\n        }\n        originals.push({\n          mesh: child,\n          material: baseMat\n        });\n\n        // Create tinted material safely\n        var tinted;\n        if (typeof baseMat.clone === 'function') {\n          try {\n            tinted = baseMat.clone();\n          } catch (e) {\n            console.warn('Failed to clone material:', e);\n            tinted = baseMat;\n          }\n        } else {\n          tinted = new three__WEBPACK_IMPORTED_MODULE_1__.MeshStandardMaterial({\n            color: highlightColor,\n            emissive: highlightColor,\n            emissiveIntensity: 0.5\n          });\n        }\n\n        // Apply green tint\n        if (tinted !== baseMat) {\n          var _baseMat$opacity;\n          if ('emissive' in tinted && tinted.emissive && typeof tinted.emissive.copy === 'function') {\n            try {\n              var _tinted$emissiveInten;\n              tinted.emissive.copy(highlightColor);\n              tinted.emissiveIntensity = Math.max(0.5, (_tinted$emissiveInten = tinted.emissiveIntensity) !== null && _tinted$emissiveInten !== void 0 ? _tinted$emissiveInten : 0);\n            } catch (e) {\n              console.warn('Failed to set emissive:', e);\n            }\n          }\n          if ('color' in tinted && tinted.color && typeof tinted.color.lerp === 'function') {\n            try {\n              var newColor = tinted.color.clone();\n              newColor.lerp(highlightColor, 0.45);\n              tinted.color = newColor;\n            } catch (e) {\n              console.warn('Failed to lerp color:', e);\n            }\n          }\n          tinted.transparent = true;\n          tinted.opacity = Math.min(0.95, (_baseMat$opacity = baseMat.opacity) !== null && _baseMat$opacity !== void 0 ? _baseMat$opacity : 1);\n          tinted.needsUpdate = true;\n          child.material = tinted;\n        }\n      });\n      this._highlighted.set(root, {\n        originals: originals\n      });\n      this._highlightRoots.add(root);\n      console.log(\"\\u2705 Applied green outline to root with \".concat(originals.length, \" meshes\"));\n    }\n  }, {\n    key: \"_clearGreenOutline\",\n    value: function _clearGreenOutline(root) {\n      if (!root) return;\n      var rec = this._highlighted.get(root);\n      if (!rec) {\n        this._highlightRoots[\"delete\"](root);\n        return;\n      }\n      rec.originals.forEach(function (_ref3) {\n        var mesh = _ref3.mesh,\n          material = _ref3.material;\n        if (!mesh) return;\n        var original = mesh.userData.__surroundOriginalMaterial || material;\n        if (original) {\n          mesh.material = original;\n        }\n        delete mesh.userData.__surroundOriginalMaterial;\n      });\n      this._highlighted[\"delete\"](root);\n      this._highlightRoots[\"delete\"](root);\n      console.log(\"\\u2705 Cleared green outline from root\");\n    }\n  }, {\n    key: \"clearAllGreenOutlines\",\n    value: function clearAllGreenOutlines() {\n      console.log(\"\\uD83E\\uDDF9 Clearing all green outlines (\".concat(this._highlightRoots.size, \" roots)\"));\n      var roots = Array.from(this._highlightRoots);\n      for (var _i3 = 0, _roots = roots; _i3 < _roots.length; _i3++) {\n        var root = _roots[_i3];\n        this._clearGreenOutline(root);\n      }\n\n      // Extra cleanup pass\n      for (var _i4 = 0, _Array$from3 = Array.from(this._highlighted.keys()); _i4 < _Array$from3.length; _i4++) {\n        var _root = _Array$from3[_i4];\n        this._clearGreenOutline(_root);\n      }\n      this._autoHighlightedIds.clear();\n      this._highlightById.clear();\n      console.log(\"\\u2705 All outlines cleared\");\n    }\n  }, {\n    key: \"stopAllManualPlayback\",\n    value: function () {\n      var _stopAllManualPlayback = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee11() {\n        var _i5, _Array$from4, id, _s2, _s3;\n        return _regeneratorRuntime().wrap(function _callee11$(_context12) {\n          while (1) switch (_context12.prev = _context12.next) {\n            case 0:\n              console.log(' Stopping ALL manual playback');\n              for (_i5 = 0, _Array$from4 = Array.from(this._dragPlayingIds); _i5 < _Array$from4.length; _i5++) {\n                id = _Array$from4[_i5];\n                _s2 = this.sources.get(id);\n                if (_s2 && this._isSourcePlaying(_s2)) {\n                  try {\n                    this._stopSource(_s2, this.currentMode === 'main');\n                  } catch (_unused4) {}\n                }\n              }\n              this._dragPlayingIds.clear();\n              if (this._activeOneShotId != null) {\n                _s3 = this.sources.get(this._activeOneShotId);\n                if (_s3 && this._isSourcePlaying(_s3)) {\n                  try {\n                    this._stopSource(_s3, this.currentMode === 'main');\n                  } catch (_unused5) {}\n                }\n                this._activeOneShotId = null;\n              }\n              this.stopSequential();\n              this.clearAllGreenOutlines();\n              console.log(' All audio stopped');\n            case 7:\n            case \"end\":\n              return _context12.stop();\n          }\n        }, _callee11, this);\n      }));\n      function stopAllManualPlayback() {\n        return _stopAllManualPlayback.apply(this, arguments);\n      }\n      return stopAllManualPlayback;\n    }()\n  }, {\n    key: \"_stopOtherManualPlayback\",\n    value: function () {\n      var _stopOtherManualPlayback2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee12() {\n        var exceptId,\n          _i6,\n          _Array$from5,\n          otherId,\n          _s4,\n          activeSource,\n          _args13 = arguments;\n        return _regeneratorRuntime().wrap(function _callee12$(_context13) {\n          while (1) switch (_context13.prev = _context13.next) {\n            case 0:\n              exceptId = _args13.length > 0 && _args13[0] !== undefined ? _args13[0] : null;\n              _i6 = 0, _Array$from5 = Array.from(this._dragPlayingIds);\n            case 2:\n              if (!(_i6 < _Array$from5.length)) {\n                _context13.next = 14;\n                break;\n              }\n              otherId = _Array$from5[_i6];\n              if (!(otherId === exceptId)) {\n                _context13.next = 6;\n                break;\n              }\n              return _context13.abrupt(\"continue\", 11);\n            case 6:\n              _s4 = this.sources.get(otherId);\n              if (_s4) {\n                _s4._oneShotToken = (_s4._oneShotToken || 0) + 1;\n              }\n              try {\n                this._stopSource(_s4, this.currentMode === 'main');\n              } catch (_unused6) {}\n              this._dragPlayingIds[\"delete\"](otherId);\n              this._unhighlightSource(otherId);\n            case 11:\n              _i6++;\n              _context13.next = 2;\n              break;\n            case 14:\n              if (this._activeOneShotId != null && this._activeOneShotId !== exceptId) {\n                activeSource = this.sources.get(this._activeOneShotId);\n                if (activeSource) {\n                  activeSource._oneShotToken = (activeSource._oneShotToken || 0) + 1;\n                }\n                this._unhighlightSource(this._activeOneShotId);\n                this._activeOneShotId = null;\n              }\n            case 15:\n            case \"end\":\n              return _context13.stop();\n          }\n        }, _callee12, this);\n      }));\n      function _stopOtherManualPlayback() {\n        return _stopOtherManualPlayback2.apply(this, arguments);\n      }\n      return _stopOtherManualPlayback;\n    }()\n  }, {\n    key: \"_decodeBase64ToBuffer\",\n    value: function () {\n      var _decodeBase64ToBuffer2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee13(base64) {\n        var bin, arr, i;\n        return _regeneratorRuntime().wrap(function _callee13$(_context14) {\n          while (1) switch (_context14.prev = _context14.next) {\n            case 0:\n              bin = atob(base64);\n              arr = new Uint8Array(bin.length);\n              for (i = 0; i < bin.length; i++) arr[i] = bin.charCodeAt(i);\n              return _context14.abrupt(\"return\", arr.buffer);\n            case 4:\n            case \"end\":\n              return _context14.stop();\n          }\n        }, _callee13);\n      }));\n      function _decodeBase64ToBuffer(_x11) {\n        return _decodeBase64ToBuffer2.apply(this, arguments);\n      }\n      return _decodeBase64ToBuffer;\n    }()\n  }, {\n    key: \"_emitPlaybackState\",\n    value: function _emitPlaybackState(playing) {\n      try {\n        window.dispatchEvent(new CustomEvent('surround-playback-state', {\n          detail: {\n            playing: !!playing\n          }\n        }));\n      } catch (_unused7) {}\n    }\n  }, {\n    key: \"hasUserRequestedSoundscape\",\n    value: function hasUserRequestedSoundscape() {\n      return this._userRequestedPlay;\n    }\n  }, {\n    key: \"startMode\",\n    value: function () {\n      var _startMode = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee14() {\n        var fadeMs,\n          _args15 = arguments;\n        return _regeneratorRuntime().wrap(function _callee14$(_context15) {\n          while (1) switch (_context15.prev = _context15.next) {\n            case 0:\n              fadeMs = _args15.length > 0 && _args15[0] !== undefined ? _args15[0] : 500;\n              this.stopSequential();\n              _context15.next = 4;\n              return this.fadeOutAll(fadeMs, true);\n            case 4:\n            case \"end\":\n              return _context15.stop();\n          }\n        }, _callee14, this);\n      }));\n      function startMode() {\n        return _startMode.apply(this, arguments);\n      }\n      return startMode;\n    }()\n  }, {\n    key: \"resumeMainMode\",\n    value: function resumeMainMode() {\n      var gapSeconds = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 5;\n      if (!this._userRequestedPlay) return;\n      return this.playAll(gapSeconds);\n    }\n  }, {\n    key: \"stopUserSoundscape\",\n    value: function () {\n      var _stopUserSoundscape = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee15() {\n        var _this8 = this;\n        var fadeMs,\n          wasActive,\n          currentIdx,\n          _args16 = arguments;\n        return _regeneratorRuntime().wrap(function _callee15$(_context16) {\n          while (1) switch (_context16.prev = _context16.next) {\n            case 0:\n              fadeMs = _args16.length > 0 && _args16[0] !== undefined ? _args16[0] : 400;\n              wasActive = this._seqActive || this._userRequestedPlay; // ADDED: Store current state before stopping\n              currentIdx = this._seqIdx;\n              this._userRequestedPlay = false;\n              this.stopSequential();\n              _context16.next = 7;\n              return this.fadeOutAll(fadeMs, true);\n            case 7:\n              this._activeOneShotId = null;\n\n              // FIXED: Don't clear outlines immediately - let them fade\n              setTimeout(function () {\n                _this8.clearAllGreenOutlines();\n              }, fadeMs);\n              if (wasActive) {\n                this._emitPlaybackState(false);\n              }\n            case 10:\n            case \"end\":\n              return _context16.stop();\n          }\n        }, _callee15, this);\n      }));\n      function stopUserSoundscape() {\n        return _stopUserSoundscape.apply(this, arguments);\n      }\n      return stopUserSoundscape;\n    }() // Make sure this method exists and works properly\n  }, {\n    key: \"stopOneShotById\",\n    value: function () {\n      var _stopOneShotById = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee16(id) {\n        var fadeMs,\n          s,\n          _args17 = arguments;\n        return _regeneratorRuntime().wrap(function _callee16$(_context17) {\n          while (1) switch (_context17.prev = _context17.next) {\n            case 0:\n              fadeMs = _args17.length > 1 && _args17[1] !== undefined ? _args17[1] : 300;\n              if (this.sources.has(id)) {\n                _context17.next = 4;\n                break;\n              }\n              console.warn(\"\\u26A0\\uFE0F Cannot stop one-shot \".concat(id, \" - source not found\"));\n              return _context17.abrupt(\"return\");\n            case 4:\n              console.log(\"\\uD83D\\uDED1 Stopping one-shot \".concat(id, \" with \").concat(fadeMs, \"ms fade\"));\n              s = this.sources.get(id);\n              if (s) {\n                s._oneShotToken = (s._oneShotToken || 0) + 1; // invalidate pending checks\n              }\n\n              // CRITICAL: Stop the source and WAIT for fade to complete\n              if (!this._isSourcePlaying(s)) {\n                _context17.next = 10;\n                break;\n              }\n              _context17.next = 10;\n              return this._fadeToZero(id, fadeMs, true);\n            case 10:\n              // Clear highlight AFTER fade completes\n              this._unhighlightSource(id);\n\n              // Remove from tracking\n              this._activeOneShotIds[\"delete\"](id);\n              if (this._activeOneShotId === id) {\n                this._activeOneShotId = null;\n              }\n              console.log(\"\\u2705 One-shot \".concat(id, \" stopped and faded out\"));\n            case 14:\n            case \"end\":\n              return _context17.stop();\n          }\n        }, _callee16, this);\n      }));\n      function stopOneShotById(_x12) {\n        return _stopOneShotById.apply(this, arguments);\n      }\n      return stopOneShotById;\n    }()\n  }]);\n}();\n\n//# sourceURL=webpack://sound-particle-visualization/./src/audio/SurroundController.js?");

/***/ }),

/***/ "./src/audio/surround-sound-context.js":
/*!*********************************************!*\
  !*** ./src/audio/surround-sound-context.js ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SurroundContext: () => (/* binding */ SurroundContext)\n/* harmony export */ });\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\"); }\nfunction _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }\nfunction _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", { writable: !1 }), e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nvar SurroundContext = /*#__PURE__*/function () {\n  function SurroundContext(w, roomWidth, roomHeight, roomDepth) {\n    _classCallCheck(this, SurroundContext);\n    this.actx = new (w.AudioContext || w.webkitAudioContext)();\n\n    // Store room dimensions (Three.js: X=width, Y=height, Z=depth)\n    this.roomWidth = roomWidth;\n    this.roomHeight = roomHeight;\n    this.roomDepth = roomDepth;\n    this.longestSide = Math.max(roomWidth, roomHeight, roomDepth);\n\n    // Create listener (represents the user's ears)\n    this.listener = this.actx.listener;\n\n    // Set listener position at center (0, 0, 0) in Three.js coordinates\n    if (this.listener.positionX) {\n      this.listener.positionX.setValueAtTime(0, this.actx.currentTime);\n      this.listener.positionY.setValueAtTime(0, this.actx.currentTime);\n      this.listener.positionZ.setValueAtTime(0, this.actx.currentTime);\n    } else {\n      this.listener.setPosition(0, 0, 0);\n    }\n\n    // Set listener orientation (facing negative Z in Three.js)\n    // Forward vector: (0, 0, -1) - looking into the screen\n    // Up vector: (0, 1, 0) - Y is up\n    if (this.listener.forwardX) {\n      this.listener.forwardX.setValueAtTime(0, this.actx.currentTime);\n      this.listener.forwardY.setValueAtTime(0, this.actx.currentTime);\n      this.listener.forwardZ.setValueAtTime(-1, this.actx.currentTime);\n      this.listener.upX.setValueAtTime(0, this.actx.currentTime);\n      this.listener.upY.setValueAtTime(1, this.actx.currentTime);\n      this.listener.upZ.setValueAtTime(0, this.actx.currentTime);\n    } else {\n      this.listener.setOrientation(0, 0, -1, 0, 1, 0);\n    }\n    console.log(\"\\uD83C\\uDFA7 Web Audio 3D Spatialization initialized\");\n    console.log(\"   Room: \".concat(roomWidth, \" x \").concat(roomHeight, \" x \").concat(roomDepth));\n    console.log(\"   Listener at origin, facing -Z (Three.js coordinate system)\");\n  }\n  return _createClass(SurroundContext, [{\n    key: \"createSource\",\n    value: function createSource() {\n      var x = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var z = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      var spatial = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n      return new SpatialSource(this.actx, x, y, z, this.longestSide, spatial);\n    }\n  }, {\n    key: \"setListenerPosition\",\n    value: function setListenerPosition(x, y, z) {\n      if (this.listener.positionX) {\n        this.listener.positionX.setValueAtTime(x, this.actx.currentTime);\n        this.listener.positionY.setValueAtTime(y, this.actx.currentTime);\n        this.listener.positionZ.setValueAtTime(z, this.actx.currentTime);\n      } else {\n        this.listener.setPosition(x, y, z);\n      }\n    }\n  }, {\n    key: \"setListenerOrientation\",\n    value: function setListenerOrientation(forwardX, forwardY, forwardZ, upX, upY, upZ) {\n      if (this.listener.forwardX) {\n        this.listener.forwardX.setValueAtTime(forwardX, this.actx.currentTime);\n        this.listener.forwardY.setValueAtTime(forwardY, this.actx.currentTime);\n        this.listener.forwardZ.setValueAtTime(forwardZ, this.actx.currentTime);\n        this.listener.upX.setValueAtTime(upX, this.actx.currentTime);\n        this.listener.upY.setValueAtTime(upY, this.actx.currentTime);\n        this.listener.upZ.setValueAtTime(upZ, this.actx.currentTime);\n      } else {\n        this.listener.setOrientation(forwardX, forwardY, forwardZ, upX, upY, upZ);\n      }\n    }\n  }, {\n    key: \"audioContext\",\n    get: function get() {\n      return this.actx;\n    }\n  }]);\n}();\nvar SpatialSource = /*#__PURE__*/function () {\n  function SpatialSource(audioContext, x, y, z, longestSide) {\n    var spatial = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : true;\n    _classCallCheck(this, SpatialSource);\n    this.ctx = audioContext;\n    this.longestSide = longestSide;\n    this.isSpatial = spatial;\n\n    // Create audio nodes\n    this.gainNode = this.ctx.createGain();\n    if (spatial) {\n      // Create panner for 3D spatialization\n      this.pannerNode = this.ctx.createPanner();\n\n      // Configure panner for 3D spatialization - natural settings\n      this.pannerNode.panningModel = 'HRTF';\n      this.pannerNode.distanceModel = 'linear';\n      this.pannerNode.refDistance = 1;\n      this.pannerNode.maxDistance = longestSide * 2;\n      this.pannerNode.rolloffFactor = 3;\n      this.pannerNode.coneInnerAngle = 360;\n      this.pannerNode.coneOuterAngle = 360;\n      this.pannerNode.coneOuterGain = 0;\n\n      // Connect: gain -> panner -> destination\n      this.gainNode.connect(this.pannerNode);\n      this.pannerNode.connect(this.ctx.destination);\n    } else {\n      // Non-spatial: just connect gain directly to destination (stereo)\n      this.gainNode.connect(this.ctx.destination);\n      this.pannerNode = null;\n    }\n\n    // Natural gain (no boost)\n    this.gainNode.gain.setValueAtTime(1.0, this.ctx.currentTime);\n\n    // Position (Three.js coordinates) - only used for spatial sources\n    this.x = x;\n    this.y = y;\n    this.z = z;\n    if (spatial) {\n      this.setPosition(x, y, z);\n    }\n\n    // Playback state\n    this.disposed = false;\n    this.audioBuffer = null;\n    this.bufferSource = null;\n    this.isPlaying = false;\n    this.looping = false;\n    this.isFadingOut = false;\n    this.fadeOutTimer = null;\n    var mode = spatial ? 'spatial 3D' : 'stereo';\n    console.log(\"\\uD83D\\uDD0A SpatialSource created in \".concat(mode, \" mode\"));\n  }\n  return _createClass(SpatialSource, [{\n    key: \"input\",\n    get: function get() {\n      return this.gainNode;\n    }\n  }, {\n    key: \"setPosition\",\n    value: function setPosition(x, y, z) {\n      if (!this.isSpatial || !this.pannerNode) return;\n      this.x = x;\n      this.y = y;\n      this.z = z;\n\n      // Update panner position using Three.js coordinates\n      if (this.pannerNode.positionX) {\n        // Modern API\n        this.pannerNode.positionX.setValueAtTime(x, this.ctx.currentTime);\n        this.pannerNode.positionY.setValueAtTime(y, this.ctx.currentTime);\n        this.pannerNode.positionZ.setValueAtTime(z, this.ctx.currentTime);\n      } else {\n        // Legacy API\n        this.pannerNode.setPosition(x, y, z);\n      }\n    }\n  }, {\n    key: \"setOrientation\",\n    value: function setOrientation(x, y, z) {\n      if (!this.isSpatial || !this.pannerNode) return;\n\n      // Set the direction the source is pointing (for directional sources)\n      if (this.pannerNode.orientationX) {\n        this.pannerNode.orientationX.setValueAtTime(x, this.ctx.currentTime);\n        this.pannerNode.orientationY.setValueAtTime(y, this.ctx.currentTime);\n        this.pannerNode.orientationZ.setValueAtTime(z, this.ctx.currentTime);\n      } else {\n        this.pannerNode.setOrientation(x, y, z);\n      }\n    }\n  }, {\n    key: \"setBuffer\",\n    value: function setBuffer(buffer) {\n      if (this.disposed) return;\n      this.audioBuffer = buffer;\n    }\n  }, {\n    key: \"setLoop\",\n    value: function setLoop(loop) {\n      this.looping = loop;\n      if (this.bufferSource) {\n        this.bufferSource.loop = loop;\n      }\n    }\n  }, {\n    key: \"setGain\",\n    value: function setGain(value) {\n      if (this.disposed) return;\n      // No boost - natural gain\n      this.gainNode.gain.setValueAtTime(value, this.ctx.currentTime);\n    }\n  }, {\n    key: \"getGain\",\n    value: function getGain() {\n      return this.disposed ? 0 : this.gainNode.gain.value;\n    }\n\n    // Distance model configuration\n  }, {\n    key: \"setDistanceModel\",\n    value: function setDistanceModel(model) {\n      if (!this.isSpatial || !this.pannerNode) return;\n      this.pannerNode.distanceModel = model;\n    }\n  }, {\n    key: \"setRefDistance\",\n    value: function setRefDistance(distance) {\n      if (!this.isSpatial || !this.pannerNode) return;\n      this.pannerNode.refDistance = distance;\n      console.log(\"\\uD83D\\uDD0A RefDistance set to: \".concat(distance));\n    }\n  }, {\n    key: \"setMaxDistance\",\n    value: function setMaxDistance(distance) {\n      if (!this.isSpatial || !this.pannerNode) return;\n      this.pannerNode.maxDistance = distance;\n      console.log(\"\\uD83D\\uDD0A MaxDistance set to: \".concat(distance));\n    }\n  }, {\n    key: \"setRolloffFactor\",\n    value: function setRolloffFactor(factor) {\n      if (!this.isSpatial || !this.pannerNode) return;\n      this.pannerNode.rolloffFactor = factor;\n      console.log(\"\\uD83D\\uDD0A Rolloff factor set to: \".concat(factor));\n    }\n\n    // Cone configuration for directional sources\n  }, {\n    key: \"setConeAngles\",\n    value: function setConeAngles(innerAngle, outerAngle) {\n      if (!this.isSpatial || !this.pannerNode) return;\n      this.pannerNode.coneInnerAngle = innerAngle;\n      this.pannerNode.coneOuterAngle = outerAngle;\n    }\n  }, {\n    key: \"setConeOuterGain\",\n    value: function setConeOuterGain(gain) {\n      if (!this.isSpatial || !this.pannerNode) return;\n      this.pannerNode.coneOuterGain = gain;\n    }\n  }, {\n    key: \"play\",\n    value: function play() {\n      var _this = this;\n      if (this.disposed || !this.audioBuffer || this.isPlaying) return;\n\n      // Cancel any ongoing fade out\n      this.isFadingOut = false;\n      if (this.fadeOutTimer) {\n        clearTimeout(this.fadeOutTimer);\n        this.fadeOutTimer = null;\n      }\n\n      // Create new buffer source\n      this.bufferSource = this.ctx.createBufferSource();\n      this.bufferSource.buffer = this.audioBuffer;\n      this.bufferSource.loop = this.looping;\n\n      // Connect to gain node\n      this.bufferSource.connect(this.gainNode);\n\n      // Handle end\n      this.bufferSource.onended = function () {\n        if (!_this.looping && !_this.isFadingOut) {\n          _this.isPlaying = false;\n        }\n      };\n\n      // Start playback\n      this.bufferSource.start(0);\n      this.isPlaying = true;\n      if (this.isSpatial) {\n        var distance = Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\n        console.log(\"\\u25B6\\uFE0F Playing 3D audio at position (\".concat(this.x.toFixed(1), \", \").concat(this.y.toFixed(1), \", \").concat(this.z.toFixed(1), \") | Distance: \").concat(distance.toFixed(1), \" | Gain: \").concat(this.gainNode.gain.value.toFixed(2)));\n      } else {\n        console.log(\"\\u25B6\\uFE0F Playing stereo audio | Gain: \".concat(this.gainNode.gain.value.toFixed(2)));\n      }\n    }\n  }, {\n    key: \"fadeOut\",\n    value: function fadeOut() {\n      var _this2 = this;\n      var duration = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 500;\n      if (!this.bufferSource || !this.isPlaying || this.isFadingOut) return;\n      this.isFadingOut = true;\n      var startGain = this.gainNode.gain.value;\n      var startTime = this.ctx.currentTime;\n\n      // Linear fade out using Web Audio API\n      this.gainNode.gain.setValueAtTime(startGain, startTime);\n      this.gainNode.gain.linearRampToValueAtTime(0, startTime + duration / 1000);\n\n      // Stop the source after fade completes\n      this.fadeOutTimer = setTimeout(function () {\n        _this2.stop();\n        _this2.isFadingOut = false;\n        _this2.fadeOutTimer = null;\n      }, duration);\n      console.log(\"\\uD83D\\uDD09 Fading out audio over \".concat(duration, \"ms\"));\n    }\n  }, {\n    key: \"stop\",\n    value: function stop() {\n      if (!this.bufferSource || !this.isPlaying) return;\n\n      // Cancel fade out if in progress\n      if (this.fadeOutTimer) {\n        clearTimeout(this.fadeOutTimer);\n        this.fadeOutTimer = null;\n      }\n      try {\n        this.bufferSource.stop();\n        this.bufferSource.disconnect();\n      } catch (e) {\n        console.warn('Error stopping buffer source:', e);\n      }\n      this.bufferSource = null;\n      this.isPlaying = false;\n      this.isFadingOut = false;\n    }\n  }, {\n    key: \"dispose\",\n    value: function dispose() {\n      if (this.disposed) return;\n      this.stop();\n      this.gainNode.disconnect();\n      if (this.pannerNode) {\n        this.pannerNode.disconnect();\n      }\n      this.disposed = true;\n      this.audioBuffer = null;\n      console.log(\"\\uD83D\\uDDD1\\uFE0F Disposed audio source\");\n    }\n  }]);\n}();\n\n//# sourceURL=webpack://sound-particle-visualization/./src/audio/surround-sound-context.js?");

/***/ }),

/***/ "./src/fonts/Garet-Book.ttf":
/*!**********************************!*\
  !*** ./src/fonts/Garet-Book.ttf ***!
  \**********************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("module.exports = __webpack_require__.p + \"927f4e0c1c6f398e18ed.ttf\";\n\n//# sourceURL=webpack://sound-particle-visualization/./src/fonts/Garet-Book.ttf?");

/***/ }),

/***/ "./src/main.js":
/*!*********************!*\
  !*** ./src/main.js ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var three__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! three */ \"./node_modules/three/build/three.module.js\");\n/* harmony import */ var _components_ParticleSystem__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./components/ParticleSystem */ \"./src/components/ParticleSystem.js\");\n/* harmony import */ var three_examples_jsm_controls_OrbitControls_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! three/examples/jsm/controls/OrbitControls.js */ \"./node_modules/three/examples/jsm/controls/OrbitControls.js\");\n/* harmony import */ var _components_EvolvingUI__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./components/EvolvingUI */ \"./src/components/EvolvingUI.js\");\n/* harmony import */ var _components_SaveMode__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./components/SaveMode */ \"./src/components/SaveMode.js\");\n/* harmony import */ var _components_Library__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./components/Library */ \"./src/components/Library.js\");\n/* harmony import */ var _components_PythonCommunication_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./components/PythonCommunication.js */ \"./src/components/PythonCommunication.js\");\n/* harmony import */ var _audio_SurroundController_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./audio/SurroundController.js */ \"./src/audio/SurroundController.js\");\n/* harmony import */ var _components_LoadingScreen_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./components/LoadingScreen.js */ \"./src/components/LoadingScreen.js\");\n/* harmony import */ var three_examples_jsm_postprocessing_EffectComposer_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! three/examples/jsm/postprocessing/EffectComposer.js */ \"./node_modules/three/examples/jsm/postprocessing/EffectComposer.js\");\n/* harmony import */ var three_examples_jsm_postprocessing_RenderPass_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! three/examples/jsm/postprocessing/RenderPass.js */ \"./node_modules/three/examples/jsm/postprocessing/RenderPass.js\");\n/* harmony import */ var three_examples_jsm_postprocessing_UnrealBloomPass_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! three/examples/jsm/postprocessing/UnrealBloomPass.js */ \"./node_modules/three/examples/jsm/postprocessing/UnrealBloomPass.js\");\n/* harmony import */ var three_examples_jsm_postprocessing_ShaderPass_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! three/examples/jsm/postprocessing/ShaderPass.js */ \"./node_modules/three/examples/jsm/postprocessing/ShaderPass.js\");\n/* harmony import */ var _styles_css__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./styles.css */ \"./src/styles.css\");\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _createForOfIteratorHelper(r, e) { var t = \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && \"number\" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t[\"return\"] || t[\"return\"](); } finally { if (u) throw o; } } }; }\nfunction _unsupportedIterableToArray(r, a) { if (r) { if (\"string\" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }\nfunction _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }\nfunction _regeneratorRuntime() { \"use strict\"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = \"function\" == typeof Symbol ? Symbol : {}, a = i.iterator || \"@@iterator\", c = i.asyncIterator || \"@@asyncIterator\", u = i.toStringTag || \"@@toStringTag\"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, \"\"); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, \"_invoke\", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: \"normal\", arg: t.call(e, r) }; } catch (t) { return { type: \"throw\", arg: t }; } } e.wrap = wrap; var h = \"suspendedStart\", l = \"suspendedYield\", f = \"executing\", s = \"completed\", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { [\"next\", \"throw\", \"return\"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if (\"throw\" !== c.type) { var u = c.arg, h = u.value; return h && \"object\" == _typeof(h) && n.call(h, \"__await\") ? e.resolve(h.__await).then(function (t) { invoke(\"next\", t, i, a); }, function (t) { invoke(\"throw\", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke(\"throw\", t, i, a); }); } a(c.arg); } var r; o(this, \"_invoke\", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error(\"Generator is already running\"); if (o === s) { if (\"throw\" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if (\"next\" === n.method) n.sent = n._sent = n.arg;else if (\"throw\" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else \"return\" === n.method && n.abrupt(\"return\", n.arg); o = f; var p = tryCatch(e, r, n); if (\"normal\" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } \"throw\" === p.type && (o = s, n.method = \"throw\", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, \"throw\" === n && e.iterator[\"return\"] && (r.method = \"return\", r.arg = t, maybeInvokeDelegate(e, r), \"throw\" === r.method) || \"return\" !== n && (r.method = \"throw\", r.arg = new TypeError(\"The iterator does not provide a '\" + n + \"' method\")), y; var i = tryCatch(o, e.iterator, r.arg); if (\"throw\" === i.type) return r.method = \"throw\", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, \"return\" !== r.method && (r.method = \"next\", r.arg = t), r.delegate = null, y) : a : (r.method = \"throw\", r.arg = new TypeError(\"iterator result is not an object\"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = \"normal\", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: \"root\" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || \"\" === e) { var r = e[a]; if (r) return r.call(e); if (\"function\" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(_typeof(e) + \" is not iterable\"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, \"constructor\", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, \"constructor\", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, \"GeneratorFunction\"), e.isGeneratorFunction = function (t) { var e = \"function\" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || \"GeneratorFunction\" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, \"GeneratorFunction\")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, \"Generator\"), define(g, a, function () { return this; }), define(g, \"toString\", function () { return \"[object Generator]\"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) \"t\" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if (\"throw\" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = \"throw\", a.arg = e, r.next = n, o && (r.method = \"next\", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if (\"root\" === i.tryLoc) return handle(\"end\"); if (i.tryLoc <= this.prev) { var c = n.call(i, \"catchLoc\"), u = n.call(i, \"finallyLoc\"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error(\"try statement without catch or finally\"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, \"finallyLoc\") && this.prev < o.finallyLoc) { var i = o; break; } } i && (\"break\" === t || \"continue\" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = \"next\", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if (\"throw\" === t.type) throw t.arg; return \"break\" === t.type || \"continue\" === t.type ? this.next = t.arg : \"return\" === t.type ? (this.rval = this.arg = t.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, \"catch\": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if (\"throw\" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error(\"illegal catch attempt\"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, \"next\" === this.method && (this.arg = t), y; } }, e; }\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// CRITICAL: Block ALL keyboard events completely (except Escape in modes)\ndocument.addEventListener('keydown', function (e) {\n  var _window$modeManager, _window$modeManager2, _window$modeManager3;\n  // CRITICAL: Don't intercept if user is in ANY input field\n  var activeEl = document.activeElement;\n  var isInInput = activeEl && (activeEl.tagName === 'INPUT' || activeEl.tagName === 'TEXTAREA' || activeEl.isContentEditable || activeEl.closest('input') || activeEl.closest('textarea'));\n  if (isInInput) {\n    console.log(' Allowing input field:', activeEl.tagName);\n    return; // Let input fields work normally\n  }\n\n  // Block ALL keys during mode transitions\n  if (window.__modeTransitioning) {\n    console.log(' BLOCKING ALL KEYS during transition:', e.key);\n    e.preventDefault();\n    e.stopPropagation();\n    e.stopImmediatePropagation();\n    return;\n  }\n\n  // FIXED: Check if in special mode using modeManager instead of text\n  var isSaveMode = (_window$modeManager = window.modeManager) === null || _window$modeManager === void 0 ? void 0 : _window$modeManager.isActive('save');\n  var isEvolveMode = (_window$modeManager2 = window.modeManager) === null || _window$modeManager2 === void 0 ? void 0 : _window$modeManager2.isActive('evolve');\n  var isLibraryMode = (_window$modeManager3 = window.modeManager) === null || _window$modeManager3 === void 0 ? void 0 : _window$modeManager3.isActive('library');\n  var isAnyMode = isSaveMode || isEvolveMode || isLibraryMode;\n  if (isAnyMode) {\n    // FIXED: Only handle Escape key in modes\n    if (e.key === 'Escape') {\n      console.log(' Escape pressed - exiting mode');\n      e.preventDefault();\n      e.stopPropagation();\n      e.stopImmediatePropagation();\n\n      // Determine which mode to exit\n      if (isSaveMode) {\n        var _window$modeManager4;\n        (_window$modeManager4 = window.modeManager) === null || _window$modeManager4 === void 0 || _window$modeManager4.goTo('save');\n      } else if (isEvolveMode) {\n        var _window$modeManager5;\n        (_window$modeManager5 = window.modeManager) === null || _window$modeManager5 === void 0 || _window$modeManager5.goTo('evolve');\n      } else if (isLibraryMode) {\n        var _window$modeManager6;\n        (_window$modeManager6 = window.modeManager) === null || _window$modeManager6 === void 0 || _window$modeManager6.goTo('library');\n      }\n      return;\n    }\n\n    // Block everything else\n    console.log(' BLOCKING key in mode:', e.key);\n    e.preventDefault();\n    e.stopPropagation();\n    e.stopImmediatePropagation();\n    return;\n  }\n\n  // FIXED: In main scene, block ALL keys INCLUDING Escape\n  console.log(' BLOCKING key in main scene:', e.key);\n  e.preventDefault();\n  e.stopPropagation();\n  e.stopImmediatePropagation();\n}, true); // Use capture phase\n\n// CRITICAL: Block keyup as well\ndocument.addEventListener('keyup', function (e) {\n  var _window$modeManager7, _window$modeManager8, _window$modeManager9;\n  var activeEl = document.activeElement;\n  var isInInput = activeEl && (activeEl.tagName === 'INPUT' || activeEl.tagName === 'TEXTAREA' || activeEl.isContentEditable);\n  if (isInInput) return;\n  if (window.__modeTransitioning) {\n    e.preventDefault();\n    e.stopPropagation();\n    e.stopImmediatePropagation();\n    return;\n  }\n\n  // FIXED: Use modeManager instead of text\n  var isSaveMode = (_window$modeManager7 = window.modeManager) === null || _window$modeManager7 === void 0 ? void 0 : _window$modeManager7.isActive('save');\n  var isEvolveMode = (_window$modeManager8 = window.modeManager) === null || _window$modeManager8 === void 0 ? void 0 : _window$modeManager8.isActive('evolve');\n  var isLibraryMode = (_window$modeManager9 = window.modeManager) === null || _window$modeManager9 === void 0 ? void 0 : _window$modeManager9.isActive('library');\n  var isAnyMode = isSaveMode || isEvolveMode || isLibraryMode;\n  if (isAnyMode) {\n    // FIXED: Only allow Escape keyup in modes (block all others)\n    if (e.key === 'Escape') {\n      e.preventDefault();\n      e.stopPropagation();\n      e.stopImmediatePropagation();\n      return;\n    }\n    e.preventDefault();\n    e.stopPropagation();\n    e.stopImmediatePropagation();\n    return;\n  }\n\n  // Block all keys in main scene\n  e.preventDefault();\n  e.stopPropagation();\n  e.stopImmediatePropagation();\n}, true);\n\n// CRITICAL: Block keypress as well\ndocument.addEventListener('keypress', function (e) {\n  var _window$modeManager10, _window$modeManager11, _window$modeManager12;\n  var activeEl = document.activeElement;\n  var isInInput = activeEl && (activeEl.tagName === 'INPUT' || activeEl.tagName === 'TEXTAREA' || activeEl.isContentEditable);\n  if (isInInput) return;\n  if (window.__modeTransitioning) {\n    e.preventDefault();\n    e.stopPropagation();\n    e.stopImmediatePropagation();\n    return;\n  }\n\n  // FIXED: Use modeManager instead of text\n  var isSaveMode = (_window$modeManager10 = window.modeManager) === null || _window$modeManager10 === void 0 ? void 0 : _window$modeManager10.isActive('save');\n  var isEvolveMode = (_window$modeManager11 = window.modeManager) === null || _window$modeManager11 === void 0 ? void 0 : _window$modeManager11.isActive('evolve');\n  var isLibraryMode = (_window$modeManager12 = window.modeManager) === null || _window$modeManager12 === void 0 ? void 0 : _window$modeManager12.isActive('library');\n  var isAnyMode = isSaveMode || isEvolveMode || isLibraryMode;\n  if (isAnyMode) {\n    // FIXED: Block keypress for Escape (doesn't fire action, just prevents default)\n    if (e.key === 'Escape') {\n      e.preventDefault();\n      e.stopPropagation();\n      e.stopImmediatePropagation();\n      return;\n    }\n    e.preventDefault();\n    e.stopPropagation();\n    e.stopImmediatePropagation();\n    return;\n  }\n\n  // Block all keys in main scene\n  e.preventDefault();\n  e.stopPropagation();\n  e.stopImmediatePropagation();\n}, true);\nvar scene, camera, renderer, particleSystem, controls;\nvar composer, bloomPass, grainPass;\nvar staticFrequencyData;\nvar saveMode;\nvar loadingScreen;\n// NEW\nvar tutorial;\nvar tutorialShown = false;\n\n// Materials for selective bloom\nvar BLOOM_SCENE = 1;\nvar bloomLayer = new three__WEBPACK_IMPORTED_MODULE_13__.Layers();\nbloomLayer.set(BLOOM_SCENE);\nfunction createNavigationStructure() {\n  // Create hamburger menu container\n  var hamburgerContainer = document.createElement('div');\n  hamburgerContainer.className = 'hamburger-menu';\n\n  // Create hamburger button\n  var hamburgerButton = document.createElement('button');\n  hamburgerButton.className = 'hamburger-button';\n  hamburgerButton.innerHTML = \"\\n        <img src=\\\"/assets/icons/hamburger-menu.svg\\\" alt=\\\"Menu\\\" />\\n    \";\n\n  // Create options container\n  var optionsContainer = document.createElement('div');\n  optionsContainer.className = 'hamburger-options';\n  hamburgerContainer.appendChild(hamburgerButton);\n  hamburgerContainer.appendChild(optionsContainer);\n  document.body.appendChild(hamburgerContainer);\n\n  // NEW: Create hover message element\n  var hoverMessage = document.createElement('div');\n  hoverMessage.className = 'hamburger-hover-message';\n  document.body.appendChild(hoverMessage);\n\n  // NEW: Define messages for each option\n  var messages = {\n    evolve: \"Rate generated sounds based on your preferences to evolve new generations tailored to your taste\",\n    save: \"Save your favorite sounds from the current generation to your personal library\",\n    library: \"Browse and manage all your saved sounds and combinations\"\n  };\n\n  // IMPROVED: Track current message for smooth transitions\n  var currentMessage = '';\n  var isTransitioning = false;\n\n  // IMPROVED: Function to show/hide hover message with smooth transitions\n  var showHoverMessage = function showHoverMessage(mode) {\n    var mm = window.modeManager;\n    var anyModeActive = (mm === null || mm === void 0 ? void 0 : mm.isActive('save')) || (mm === null || mm === void 0 ? void 0 : mm.isActive('evolve')) || (mm === null || mm === void 0 ? void 0 : mm.isActive('library'));\n    if (anyModeActive) {\n      hideHoverMessage();\n      return;\n    }\n    if (messages[mode]) {\n      var newMessage = messages[mode];\n\n      // If same message, just keep it visible\n      if (currentMessage === newMessage && hoverMessage.classList.contains('visible')) {\n        return;\n      }\n\n      // If different message is showing, fade out then fade in with new message\n      if (currentMessage !== newMessage && hoverMessage.classList.contains('visible')) {\n        if (isTransitioning) return; // Prevent overlapping transitions\n\n        isTransitioning = true;\n\n        // Fade out current message\n        hoverMessage.classList.remove('visible');\n\n        // Wait for fade out to complete, then update and fade in\n        setTimeout(function () {\n          hoverMessage.textContent = newMessage;\n          currentMessage = newMessage;\n          hoverMessage.classList.add('visible');\n          setTimeout(function () {\n            isTransitioning = false;\n          }, 400); // Match CSS transition time\n        }, 400); // Match CSS transition time\n      } else {\n        // No message showing, just show new one\n        hoverMessage.textContent = newMessage;\n        currentMessage = newMessage;\n        hoverMessage.classList.add('visible');\n      }\n    }\n  };\n  var hideHoverMessage = function hideHoverMessage() {\n    hoverMessage.classList.remove('visible');\n\n    // Clear current message after fade completes\n    setTimeout(function () {\n      if (!hoverMessage.classList.contains('visible')) {\n        currentMessage = '';\n        isTransitioning = false;\n      }\n    }, 400); // Match CSS transition time\n  };\n\n  // Store reference for adding hover listeners to menu items\n  window.navigationContainers = {\n    hamburgerMenu: optionsContainer,\n    hoverMessage: {\n      show: showHoverMessage,\n      hide: hideHoverMessage\n    },\n    topLeft: document.createElement('div'),\n    topRight: document.createElement('div'),\n    bottomLeft: document.createElement('div'),\n    bottomRight: document.createElement('div')\n  };\n\n  // Toggle menu functionality\n  var isMenuOpen = false;\n  hamburgerButton.addEventListener('click', function () {\n    isMenuOpen = !isMenuOpen;\n    hamburgerButton.classList.toggle('open', isMenuOpen);\n    optionsContainer.classList.toggle('open', isMenuOpen);\n\n    // Hide message when menu closes\n    if (!isMenuOpen) {\n      hideHoverMessage();\n    }\n  });\n  document.addEventListener('click', function (e) {\n    if (!hamburgerContainer.contains(e.target) && isMenuOpen) {\n      var _window$modeManager13;\n      var isSaveModeActive = (_window$modeManager13 = window.modeManager) === null || _window$modeManager13 === void 0 ? void 0 : _window$modeManager13.isActive('save');\n      if (!isSaveModeActive) {\n        isMenuOpen = false;\n        hamburgerButton.classList.remove('open');\n        optionsContainer.classList.remove('open');\n        hideHoverMessage();\n      }\n    }\n  });\n}\n\n// function createNavigationStructure() {\n//     // Create hamburger menu container\n//     const hamburgerContainer = document.createElement('div');\n//     hamburgerContainer.className = 'hamburger-menu';\n\n//     // Create hamburger button\n//     const hamburgerButton = document.createElement('button');\n//     hamburgerButton.className = 'hamburger-button';\n//     hamburgerButton.innerHTML = `\n//         <img src=\"/assets/icons/hamburger-menu.svg\" alt=\"Menu\" />\n//     `;\n\n//     // Create options container\n//     const optionsContainer = document.createElement('div');\n//     optionsContainer.className = 'hamburger-options';\n\n//     hamburgerContainer.appendChild(hamburgerButton);\n//     hamburgerContainer.appendChild(optionsContainer);\n//     document.body.appendChild(hamburgerContainer);\n\n//     // Toggle menu functionality\n//     let isMenuOpen = false;\n//     hamburgerButton.addEventListener('click', () => {\n//         isMenuOpen = !isMenuOpen;\n//         hamburgerButton.classList.toggle('open', isMenuOpen);\n//         optionsContainer.classList.toggle('open', isMenuOpen);\n//     });\n\n//     document.addEventListener('click', (e) => {\n//         if (!hamburgerContainer.contains(e.target) && isMenuOpen) {\n\n//             const isSaveModeActive = document.querySelector('#save-btn .button-text')?.innerText === 'EXIT SAVE';\n\n//             if (!isSaveModeActive) {\n//                 isMenuOpen = false;\n//                 hamburgerButton.classList.remove('open');\n//                 optionsContainer.classList.remove('open');\n//             }\n//         }\n//     });\n\n//     // Store references for components to use\n//     window.navigationContainers = {\n//         hamburgerMenu: optionsContainer,\n\n//         topLeft: document.createElement('div'),\n//         topRight: document.createElement('div'),\n//         bottomLeft: document.createElement('div'),\n//         bottomRight: document.createElement('div')\n//     };\n// }\n\nfunction init() {\n  var _saveMode;\n  createNavigationStructure();\n\n  // Create the scene\n  scene = new three__WEBPACK_IMPORTED_MODULE_13__.Scene();\n\n  // Enhanced darker gradient background for more contrast\n  var canvas = document.createElement('canvas');\n  canvas.width = 512;\n  canvas.height = 512;\n  var context = canvas.getContext('2d');\n  var gradient = context.createRadialGradient(256, 256, 0, 256, 256, 512);\n  gradient.addColorStop(0, '#0a0a20'); // Lighter center (was #050515)\n  gradient.addColorStop(0.4, '#060a18'); // Lighter mid (was #030815)\n  gradient.addColorStop(0.8, '#040815'); // Lighter outer (was #020520)\n  gradient.addColorStop(1, '#020205'); // Very dark edge instead of pure black (was #000000)\n\n  context.fillStyle = gradient;\n  context.fillRect(0, 0, 512, 512);\n  var backgroundTexture = new three__WEBPACK_IMPORTED_MODULE_13__.CanvasTexture(canvas);\n  scene.background = backgroundTexture;\n  var gridSize = 600;\n  var gridDivisions = 60;\n\n  // Create custom grid geometry\n  var gridGeometry = new three__WEBPACK_IMPORTED_MODULE_13__.PlaneGeometry(gridSize, gridSize, gridDivisions, gridDivisions);\n\n  // Fixed shader material for dynamic grid visibility\n  var gridMaterial = new three__WEBPACK_IMPORTED_MODULE_13__.ShaderMaterial({\n    uniforms: {\n      time: {\n        value: 0\n      },\n      lightPositions: {\n        value: new Array(60).fill(0)\n      },\n      lightIntensities: {\n        value: new Array(20).fill(0)\n      },\n      maxLights: {\n        value: 0\n      },\n      gridColor: {\n        value: new three__WEBPACK_IMPORTED_MODULE_13__.Color().setHSL(0.6, 0.5, 0.3)\n      },\n      // INCREASED lightness from 0.3 to 0.4\n      gridOpacity: {\n        value: 0.45\n      } // INCREASED from 0.4 to 0.5\n    },\n    vertexShader: \"\\n            varying vec2 vUv;\\n            varying vec3 vWorldPosition;\\n            \\n            void main() {\\n                vUv = uv;\\n                vec4 worldPosition = modelMatrix * vec4(position, 1.0);\\n                vWorldPosition = worldPosition.xyz;\\n                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\\n            }\\n        \",\n    fragmentShader: \"\\n            uniform float time;\\n            uniform vec3 lightPositions[20];\\n            uniform float lightIntensities[20];\\n            uniform int maxLights;\\n            uniform vec3 gridColor;\\n            uniform float gridOpacity;\\n            \\n            varying vec2 vUv;\\n            varying vec3 vWorldPosition;\\n            \\n            void main() {\\n                // Create grid pattern\\n                vec2 grid = abs(fract(vUv * 60.0) - 0.5) / fwidth(vUv * 60.0);\\n                float line = min(grid.x, grid.y);\\n                float gridPattern = 1.0 - min(line, 1.0);\\n                \\n                // Calculate illumination from lights (particles/solids)\\n                float totalIllumination = 0.0;\\n                \\n                for(int i = 0; i < 20; i++) {\\n                    if(i >= maxLights) break;\\n                    \\n                    vec3 lightPos = lightPositions[i];\\n                    float lightIntensity = lightIntensities[i];\\n                    \\n                    if(lightIntensity > 0.0) {\\n                        float distance = length(vWorldPosition.xz - lightPos.xz);\\n                        float falloff = 1.0 / (1.0 + distance * distance * 0.015);\\n                        totalIllumination += falloff * lightIntensity;\\n                    }\\n                }\\n                \\n                // Show grid where there's illumination (no pulsing)\\n                float finalOpacity = gridPattern * totalIllumination * gridOpacity;\\n                \\n                gl_FragColor = vec4(gridColor, finalOpacity);\\n            }\\n        \",\n    transparent: true,\n    depthWrite: false,\n    side: three__WEBPACK_IMPORTED_MODULE_13__.DoubleSide\n  });\n  var dynamicGrid = new three__WEBPACK_IMPORTED_MODULE_13__.Mesh(gridGeometry, gridMaterial);\n  dynamicGrid.rotation.x = -Math.PI / 2;\n  dynamicGrid.position.y = -0.1;\n  scene.add(dynamicGrid);\n\n  // Store reference for updates\n  scene.userData.dynamicGrid = dynamicGrid;\n  var lineGroup = new three__WEBPACK_IMPORTED_MODULE_13__.Group();\n\n  // Create horizontal floating lines that move\n  for (var i = 0; i < 25; i++) {\n    var lineGeometry = new three__WEBPACK_IMPORTED_MODULE_13__.BufferGeometry();\n    var linePositions = new Float32Array([-100, 0, 0, 100, 0, 0]);\n    lineGeometry.setAttribute('position', new three__WEBPACK_IMPORTED_MODULE_13__.BufferAttribute(linePositions, 3));\n    var lineMaterial = new three__WEBPACK_IMPORTED_MODULE_13__.LineBasicMaterial({\n      color: new three__WEBPACK_IMPORTED_MODULE_13__.Color().setHSL(0.65, 0.25, 0.25 + Math.random() * 0.20),\n      transparent: true,\n      opacity: 0.15 + Math.random() * 0.15\n    });\n    var line = new three__WEBPACK_IMPORTED_MODULE_13__.Line(lineGeometry, lineMaterial);\n    line.position.set((Math.random() - 0.5) * 400, Math.random() * 100 - 20, (Math.random() - 0.5) * 400);\n    line.rotation.y = Math.random() * Math.PI * 2;\n\n    // Enhanced animation properties\n    line.userData = {\n      speed: Math.random() * 0.03 + 0.01,\n      direction: Math.random() > 0.5 ? 1 : -1,\n      oscillationSpeed: Math.random() * 0.5 + 0.3,\n      oscillationAmplitude: Math.random() * 2 + 1,\n      // This is the complete line\n      originalY: line.position.y,\n      movementType: 'horizontal'\n    };\n    lineGroup.add(line);\n  }\n\n  // Create vertical floating lines that move\n  for (var _i = 0; _i < 20; _i++) {\n    var _lineGeometry = new three__WEBPACK_IMPORTED_MODULE_13__.BufferGeometry();\n    var _linePositions = new Float32Array([0, -50, 0, 0, 50, 0]);\n    _lineGeometry.setAttribute('position', new three__WEBPACK_IMPORTED_MODULE_13__.BufferAttribute(_linePositions, 3));\n    var _lineMaterial = new three__WEBPACK_IMPORTED_MODULE_13__.LineBasicMaterial({\n      color: new three__WEBPACK_IMPORTED_MODULE_13__.Color().setHSL(0.6, 0.4, 0.20 + Math.random() * 0.15),\n      transparent: true,\n      opacity: 0.10 + Math.random() * 0.25\n    });\n    var _line = new three__WEBPACK_IMPORTED_MODULE_13__.Line(_lineGeometry, _lineMaterial);\n    _line.position.set((Math.random() - 0.5) * 300, Math.random() * 80, (Math.random() - 0.5) * 300);\n    _line.userData = {\n      speed: Math.random() * 0.02 + 0.008,\n      direction: Math.random() > 0.5 ? 1 : -1,\n      oscillationSpeed: Math.random() * 0.4 + 0.15,\n      oscillationAmplitude: Math.random() * 3 + 1.5,\n      originalX: _line.position.x,\n      movementType: 'vertical'\n    };\n    lineGroup.add(_line);\n  }\n  for (var _i2 = 0; _i2 < 15; _i2++) {\n    var _lineGeometry2 = new three__WEBPACK_IMPORTED_MODULE_13__.BufferGeometry();\n    var _linePositions2 = new Float32Array([-30, -30, 0, 30, 30, 0]);\n    _lineGeometry2.setAttribute('position', new three__WEBPACK_IMPORTED_MODULE_13__.BufferAttribute(_linePositions2, 3));\n    var _lineMaterial2 = new three__WEBPACK_IMPORTED_MODULE_13__.LineBasicMaterial({\n      color: new three__WEBPACK_IMPORTED_MODULE_13__.Color().setHSL(0.65, 0.2, 0.12 + Math.random() * 0.12),\n      transparent: true,\n      opacity: 0.1 + Math.random() * 0.2\n    });\n    var _line2 = new three__WEBPACK_IMPORTED_MODULE_13__.Line(_lineGeometry2, _lineMaterial2);\n    _line2.position.set((Math.random() - 0.5) * 350, Math.random() * 60 + 10, (Math.random() - 0.5) * 350);\n    _line2.rotation.z = Math.random() * Math.PI;\n\n    // Enhanced animation properties\n    _line2.userData = {\n      speed: Math.random() * 0.025 + 0.005,\n      direction: Math.random() > 0.5 ? 1 : -1,\n      rotationSpeed: (Math.random() - 0.5) * 0.01,\n      oscillationSpeed: Math.random() * 0.3 + 0.1,\n      oscillationAmplitude: Math.random() * 4 + 2,\n      originalZ: _line2.position.z,\n      movementType: 'diagonal'\n    };\n    lineGroup.add(_line2);\n  }\n  scene.add(lineGroup);\n  scene.userData.floatingLines = lineGroup;\n  var starsGeometry = new three__WEBPACK_IMPORTED_MODULE_13__.BufferGeometry();\n  var starsCount = 3000;\n  var starsPositions = new Float32Array(starsCount * 3);\n  var starsColors = new Float32Array(starsCount * 3);\n  for (var _i3 = 0; _i3 < starsCount * 3; _i3 += 3) {\n    // Distribute stars in a large sphere around the scene\n    var radius = 400 + Math.random() * 800;\n    var theta = Math.random() * Math.PI * 2;\n    var phi = Math.random() * Math.PI;\n    starsPositions[_i3] = radius * Math.sin(phi) * Math.cos(theta); // x\n    starsPositions[_i3 + 1] = radius * Math.cos(phi) - 200; // y \n    starsPositions[_i3 + 2] = radius * Math.sin(phi) * Math.sin(theta); // z\n\n    // INCREASED brightness for all stars\n    var colorVariation = Math.random();\n    if (colorVariation < 0.3) {\n      // Blue-white stars - BRIGHTER\n      starsColors[_i3] = 0.6 + Math.random() * 0.3; // R (was 0.4 + 0.2)\n      starsColors[_i3 + 1] = 0.7 + Math.random() * 0.3; // G (was 0.5 + 0.2)\n      starsColors[_i3 + 2] = 0.9 + Math.random() * 0.1; // B (was 0.7 + 0.2)\n    } else if (colorVariation < 0.7) {\n      // White stars - MUCH BRIGHTER\n      var white = 0.85 + Math.random() * 0.15; // (was 0.6 + 0.2)\n      starsColors[_i3] = white; // R\n      starsColors[_i3 + 1] = white; // G\n      starsColors[_i3 + 2] = white; // B\n    } else {\n      // Slightly yellow stars - BRIGHTER\n      starsColors[_i3] = 0.9 + Math.random() * 0.1; // R (was 0.7 + 0.2)\n      starsColors[_i3 + 1] = 0.8 + Math.random() * 0.15; // G (was 0.6 + 0.15)\n      starsColors[_i3 + 2] = 0.6 + Math.random() * 0.2; // B (was 0.4 + 0.15)\n    }\n  }\n  starsGeometry.setAttribute('position', new three__WEBPACK_IMPORTED_MODULE_13__.BufferAttribute(starsPositions, 3));\n  starsGeometry.setAttribute('color', new three__WEBPACK_IMPORTED_MODULE_13__.BufferAttribute(starsColors, 3));\n  var starsMaterial = new three__WEBPACK_IMPORTED_MODULE_13__.PointsMaterial({\n    size: 2.3,\n    // INCREASED from 1.2 to 2.8 (much larger)\n    transparent: true,\n    opacity: 0.7,\n    // INCREASED from 0.7 to 0.95 (almost opaque)\n    vertexColors: true,\n    fog: false,\n    blending: three__WEBPACK_IMPORTED_MODULE_13__.AdditiveBlending,\n    // NEW: makes stars glow\n    depthWrite: false // NEW: prevents z-fighting\n  });\n  var stars = new three__WEBPACK_IMPORTED_MODULE_13__.Points(starsGeometry, starsMaterial);\n  scene.add(stars);\n\n  // Store reference for subtle animation\n  scene.userData.stars = stars;\n\n  // Enhanced fog for depth\n  scene.fog = new three__WEBPACK_IMPORTED_MODULE_13__.FogExp2(0x0a0a20, 0.002); // LIGHTER fog color and LESS dense (was 0x000308, 0.003)\n\n  camera = new three__WEBPACK_IMPORTED_MODULE_13__.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 2000);\n  camera.position.set(0, 15, 30);\n  renderer = new three__WEBPACK_IMPORTED_MODULE_13__.WebGLRenderer({\n    antialias: true\n  });\n  renderer.setSize(window.innerWidth, window.innerHeight);\n  renderer.setPixelRatio(window.devicePixelRatio);\n  renderer.shadowMap.enabled = true;\n  renderer.shadowMap.type = three__WEBPACK_IMPORTED_MODULE_13__.PCFSoftShadowMap;\n  document.querySelectorAll('canvas').forEach(function (c) {\n    return c.remove();\n  });\n  document.body.appendChild(renderer.domElement);\n  controls = new three_examples_jsm_controls_OrbitControls_js__WEBPACK_IMPORTED_MODULE_1__.OrbitControls(camera, renderer.domElement);\n\n  // Enhanced lighting for better clarity\n  var ambientLight = new three__WEBPACK_IMPORTED_MODULE_13__.AmbientLight(0x5060a0, 1.2); // INCREASED from 0.8 to 1.2\n  scene.add(ambientLight);\n\n  // Primary key light - brighter and more focused\n  var keyLight = new three__WEBPACK_IMPORTED_MODULE_13__.DirectionalLight(0xffffff, 1.0); // INCREASED from 0.6 to 1.0\n  keyLight.position.set(0, 30, 25);\n  keyLight.castShadow = true;\n  keyLight.shadow.mapSize.width = 2048; // INCREASED resolution from 1024\n  keyLight.shadow.mapSize.height = 2048;\n  keyLight.shadow.camera.near = 1;\n  keyLight.shadow.camera.far = 100;\n  keyLight.shadow.bias = -0.0001;\n  scene.add(keyLight);\n\n  // Fill light - stronger for better definition\n  var fillLight = new three__WEBPACK_IMPORTED_MODULE_13__.DirectionalLight(0x6699ff, 0.8); // INCREASED from 0.5 to 0.8\n  fillLight.position.set(-20, 20, -20);\n  scene.add(fillLight);\n\n  // Secondary fill light - brighter\n  var fillLight2 = new three__WEBPACK_IMPORTED_MODULE_13__.DirectionalLight(0x8899ff, 0.7); // INCREASED from 0.4 to 0.7\n  fillLight2.position.set(30, 15, -10);\n  scene.add(fillLight2);\n\n  // Point light - more intense for central illumination\n  var pointLight = new three__WEBPACK_IMPORTED_MODULE_13__.PointLight(0x88aaff, 0.6, 100); // INCREASED from 0.3 to 0.6, range from 80 to 100\n  pointLight.position.set(0, 25, 0); // INCREASED height from 20 to 25\n  scene.add(pointLight);\n\n  // Rim light - stronger for edge definition\n  var rimLight = new three__WEBPACK_IMPORTED_MODULE_13__.DirectionalLight(0xaa99ff, 0.4); // INCREASED from 0.2 to 0.4\n  rimLight.position.set(0, -5, 20);\n  scene.add(rimLight);\n\n  // Hemisphere light - brighter for overall fill\n  var hemisphereLight = new three__WEBPACK_IMPORTED_MODULE_13__.HemisphereLight(0x7799cc, 0x443355, 0.7); // INCREASED from 0.4 to 0.7\n  scene.add(hemisphereLight);\n\n  // Wireframe lights - more visible\n  var wireframeLight1 = new three__WEBPACK_IMPORTED_MODULE_13__.DirectionalLight(0x6688bb, 0.2); // INCREASED from 0.2 to 0.4\n  wireframeLight1.position.set(40, 10, 40);\n  scene.add(wireframeLight1);\n  var wireframeLight2 = new three__WEBPACK_IMPORTED_MODULE_13__.DirectionalLight(0x8866bb, 0.4); // INCREASED from 0.2 to 0.4\n  wireframeLight2.position.set(-40, 10, -40);\n  scene.add(wireframeLight2);\n\n  // Up light - stronger for base illumination\n  var upLight = new three__WEBPACK_IMPORTED_MODULE_13__.DirectionalLight(0x5577bb, 0.3); // INCREASED from 0.15 to 0.3\n  upLight.position.set(0, -10, 0);\n  scene.add(upLight);\n\n  // NEW: Add additional top-down lights for better overall clarity\n  var topLight1 = new three__WEBPACK_IMPORTED_MODULE_13__.DirectionalLight(0x99aaff, 0.5);\n  topLight1.position.set(15, 40, 15);\n  scene.add(topLight1);\n  var topLight2 = new three__WEBPACK_IMPORTED_MODULE_13__.DirectionalLight(0x9999ff, 0.5);\n  topLight2.position.set(-15, 40, -15);\n  scene.add(topLight2);\n  scene.userData.keyLight = keyLight;\n  scene.userData.pointLight = pointLight;\n  composer = new three_examples_jsm_postprocessing_EffectComposer_js__WEBPACK_IMPORTED_MODULE_8__.EffectComposer(renderer);\n\n  // Base render pass \n  var renderPass = new three_examples_jsm_postprocessing_RenderPass_js__WEBPACK_IMPORTED_MODULE_9__.RenderPass(scene, camera);\n  composer.addPass(renderPass);\n\n  // Bloom pass\n  bloomPass = new three_examples_jsm_postprocessing_UnrealBloomPass_js__WEBPACK_IMPORTED_MODULE_10__.UnrealBloomPass(new three__WEBPACK_IMPORTED_MODULE_13__.Vector2(window.innerWidth, window.innerHeight));\n  bloomPass.threshold = 0.1;\n  bloomPass.strength = 1.2;\n  bloomPass.radius = 0.4;\n  composer.addPass(bloomPass);\n\n  // Film grain pass l\n  var FilmGrainShader = {\n    uniforms: {\n      'tDiffuse': {\n        value: 0.3\n      },\n      'time': {\n        value: 0.0\n      },\n      'nIntensity': {\n        value: 0.035\n      },\n      // Grain intensity\n      'grayscale': {\n        value: 0.5\n      }\n    },\n    vertexShader: \"\\n            varying vec2 vUv;\\n            void main() {\\n                vUv = uv;\\n                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\\n            }\\n        \",\n    fragmentShader: \"\\n            uniform sampler2D tDiffuse;\\n            uniform float time;\\n            uniform float nIntensity;\\n            uniform bool grayscale;\\n            varying vec2 vUv;\\n\\n            float random(vec2 co) {\\n                return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\\n            }\\n\\n            void main() {\\n                vec4 color = texture2D(tDiffuse, vUv);\\n                \\n                // Film grain only\\n                float grain = random(vUv + time) * nIntensity;\\n                color.rgb += grain;\\n                \\n                // Optional vignette\\n                vec2 center = vUv - 0.5;\\n                float vignette = 1.0 - dot(center, center) * 0.3;\\n                color.rgb *= vignette;\\n                \\n                gl_FragColor = color;\\n            }\\n        \"\n  };\n  grainPass = new three_examples_jsm_postprocessing_ShaderPass_js__WEBPACK_IMPORTED_MODULE_11__.ShaderPass(FilmGrainShader);\n  composer.addPass(grainPass);\n\n  // Resize handler\n  window.addEventListener('resize', function () {\n    var width = window.innerWidth;\n    var height = window.innerHeight;\n    renderer.setSize(width, height);\n    camera.aspect = width / height;\n    camera.updateProjectionMatrix();\n    composer.setSize(width, height);\n  });\n  staticFrequencyData = new Uint8Array(10);\n\n  // Create ParticleSystem WITHOUT initialization\n  particleSystem = new _components_ParticleSystem__WEBPACK_IMPORTED_MODULE_0__.ParticleSystem(scene);\n\n  // Show initial loading screen\n  loadingScreen = new _components_LoadingScreen_js__WEBPACK_IMPORTED_MODULE_7__.LoadingScreen();\n  loadingScreen.show('Waiting for data');\n\n  // CHANGED: Pass room dimensions that match the scene scale\n  var surroundController = new _audio_SurroundController_js__WEBPACK_IMPORTED_MODULE_6__.SurroundController();\n\n  // CRITICAL: Set camera for audio listener IMMEDIATELY after creating SurroundController\n  surroundController.setCamera(camera);\n  console.log(' Camera attached to audio listener');\n\n  // Track if initial data has been received\n  var initialDataReceived = false;\n  var pythonComm = new _components_PythonCommunication_js__WEBPACK_IMPORTED_MODULE_5__.PythonCommunication(particleSystem,\n  // 1. onGenerationData callback - HIDES loading screen after audio loads\n  function (data) {\n    var generationNum = data.generation || 0;\n\n    // Update loading message while audio loads\n    loadingScreen.updateMessage(\"Loading generation \".concat(generationNum, \" sounds\"));\n\n    // Set particle system (needed for audio setup)\n    surroundController.setParticleSystem(particleSystem);\n\n    // Load audio for new generation\n    surroundController.loadAll(data.solutions).then(function () {\n      console.log(\"\\u2705 Generation \".concat(generationNum, \" audio loaded\"));\n\n      // Add a small delay for visual smoothness\n      setTimeout(function () {\n        loadingScreen.hide();\n\n        // Create soundscape toggle button (only first time)\n        if (!initialDataReceived) {\n          initialDataReceived = true;\n          createSoundscapeToggle(surroundController);\n        }\n      }, 300); // 300ms delay for smooth transition\n    })[\"catch\"](function (error) {\n      console.error(' Failed to load audio:', error);\n      loadingScreen.hide();\n    });\n  },\n  // 2. onConnectionReady callback\n  function () {\n    if (!initialDataReceived) {\n      loadingScreen.updateMessage('Requesting generation data');\n    }\n  },\n  // 3. onRegenerationStart callback - SHOWS loading screen  THIS WAS MISSING!\n  function (data) {\n    var generationNum = data.generation || 0;\n    console.log(\"\\uD83D\\uDD04 Regeneration starting for generation \".concat(generationNum));\n\n    // Show loading screen immediately when regeneration starts\n    var message = initialDataReceived ? \"Loading generation \".concat(generationNum) : 'Loading initial generation';\n    loadingScreen.show(message);\n  });\n  window.pythonComm = pythonComm;\n\n  // Initialize other components\n  var library = new _components_Library__WEBPACK_IMPORTED_MODULE_4__.Library(particleSystem, scene, camera, renderer, controls);\n  var evolvingUI = new _components_EvolvingUI__WEBPACK_IMPORTED_MODULE_2__.EvolvingUI(renderer, camera, controls, particleSystem, pythonComm, library);\n  saveMode = new _components_SaveMode__WEBPACK_IMPORTED_MODULE_3__.SaveMode(renderer, camera, controls, particleSystem, library);\n\n  // modes  routing ---\n  var sc = surroundController;\n  var modeManager = {\n    evolve: evolvingUI,\n    save: saveMode,\n    library: library,\n    _locked: false,\n    isActive: function isActive(name) {\n      var _this$evolve, _this$save, _this$library;\n      if (name === 'evolve') return !!((_this$evolve = this.evolve) !== null && _this$evolve !== void 0 && _this$evolve.isEvolvingMode);\n      if (name === 'save') return !!((_this$save = this.save) !== null && _this$save !== void 0 && _this$save.isSaveMode);\n      if (name === 'library') return !!((_this$library = this.library) !== null && _this$library !== void 0 && _this$library.inSpace);\n      return false;\n    },\n    // NEW: Helper to toggle soundscape button visibility\n    _updateSoundscapeButton: function _updateSoundscapeButton() {\n      var btn = document.getElementById('soundscape-toggle-btn');\n      if (!btn) return;\n\n      // Hide if ANY mode is active, show only on main scene\n      var anyModeActive = this.isActive('evolve') || this.isActive('save') || this.isActive('library');\n      if (anyModeActive) {\n        btn.classList.add('hidden');\n      } else {\n        btn.classList.remove('hidden');\n      }\n    },\n    // REMOVED: _syncButtons() - no longer needed\n    // Normalize small leftovers when returning to main\n    _closeToMain: function _closeToMain() {\n      var _this = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              if (!sc) {\n                _context.next = 4;\n                break;\n              }\n              _context.next = 4;\n              return sc.setMode('main');\n            case 4:\n              (sc === null || sc === void 0 ? void 0 : sc.clearAllGreenOutlines) && sc.clearAllGreenOutlines();\n              _context.next = 9;\n              break;\n            case 7:\n              _context.prev = 7;\n              _context.t0 = _context[\"catch\"](0);\n            case 9:\n              _context.next = 11;\n              return new Promise(function (r) {\n                return setTimeout(r, 0);\n              });\n            case 11:\n              _this._updateSoundscapeButton();\n            case 12:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[0, 7]]);\n      }))();\n    },\n    // Exit a specific mode (idempotent), then lightly normalize to main\n    exit: function exit(name) {\n      var _arguments = arguments,\n        _this2 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var _ref, _ref$skipNormalize, skipNormalize, _this2$evolve, _this2$library, _sc$stopAllManualPlay, _this2$save, _this2$save$forceRese, _this2$save2;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _ref = _arguments.length > 1 && _arguments[1] !== undefined ? _arguments[1] : {}, _ref$skipNormalize = _ref.skipNormalize, skipNormalize = _ref$skipNormalize === void 0 ? false : _ref$skipNormalize;\n              _context2.prev = 1;\n              // CRITICAL: Stop ALL audio before exiting ANY mode\n              console.log(\"\\uD83D\\uDD07 Stopping all audio before exiting \".concat(name));\n              _context2.prev = 3;\n              _context2.next = 6;\n              return sc === null || sc === void 0 || (_sc$stopAllManualPlay = sc.stopAllManualPlayback) === null || _sc$stopAllManualPlay === void 0 ? void 0 : _sc$stopAllManualPlay.call(sc);\n            case 6:\n              _context2.next = 11;\n              break;\n            case 8:\n              _context2.prev = 8;\n              _context2.t0 = _context2[\"catch\"](3);\n              console.error('Failed to stop audio on mode exit:', _context2.t0);\n            case 11:\n              if (!(name === 'evolve' && (_this2$evolve = _this2.evolve) !== null && _this2$evolve !== void 0 && _this2$evolve.isEvolvingMode)) {\n                _context2.next = 14;\n                break;\n              }\n              _context2.next = 14;\n              return Promise.resolve(_this2.evolve.exitEvolvingMode());\n            case 14:\n              if (!(name === 'save')) {\n                _context2.next = 19;\n                break;\n              }\n              (_this2$save = _this2.save) === null || _this2$save === void 0 || (_this2$save$forceRese = _this2$save.forceReset) === null || _this2$save$forceRese === void 0 || _this2$save$forceRese.call(_this2$save, {\n                restoreMaterials: true\n              });\n              if (!((_this2$save2 = _this2.save) !== null && _this2$save2 !== void 0 && _this2$save2.isSaveMode)) {\n                _context2.next = 19;\n                break;\n              }\n              _context2.next = 19;\n              return Promise.resolve(_this2.save.exitSaveMode());\n            case 19:\n              if (!(name === 'library' && (_this2$library = _this2.library) !== null && _this2$library !== void 0 && _this2$library.inSpace)) {\n                _context2.next = 22;\n                break;\n              }\n              _context2.next = 22;\n              return Promise.resolve(_this2.library.exitSpace());\n            case 22:\n              _context2.next = 27;\n              break;\n            case 24:\n              _context2.prev = 24;\n              _context2.t1 = _context2[\"catch\"](1);\n              console.warn(\"Failed to exit mode \\\"\".concat(name, \"\\\"\"), _context2.t1);\n            case 27:\n              if (skipNormalize) {\n                _context2.next = 30;\n                break;\n              }\n              _context2.next = 30;\n              return _this2._closeToMain();\n            case 30:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[1, 24], [3, 8]]);\n      }))();\n    },\n    enter: function enter(name) {\n      var _this3 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var _sc$hasUserRequestedS, _this3$evolve, _this3$save, _this3$library;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              if (!sc) {\n                _context3.next = 4;\n                break;\n              }\n              _context3.next = 4;\n              return sc.setMode(name || 'main');\n            case 4:\n              if (!(name && sc !== null && sc !== void 0 && (_sc$hasUserRequestedS = sc.hasUserRequestedSoundscape) !== null && _sc$hasUserRequestedS !== void 0 && _sc$hasUserRequestedS.call(sc))) {\n                _context3.next = 8;\n                break;\n              }\n              console.log(\"\\uD83D\\uDD07 Stopping soundscape before entering \".concat(name));\n              _context3.next = 8;\n              return sc.stopUserSoundscape(80);\n            case 8:\n              if (!(name === 'evolve' && !((_this3$evolve = _this3.evolve) !== null && _this3$evolve !== void 0 && _this3$evolve.isEvolvingMode))) {\n                _context3.next = 11;\n                break;\n              }\n              _context3.next = 11;\n              return Promise.resolve(_this3.evolve.enterEvolvingMode());\n            case 11:\n              if (!(name === 'save' && !((_this3$save = _this3.save) !== null && _this3$save !== void 0 && _this3$save.isSaveMode))) {\n                _context3.next = 14;\n                break;\n              }\n              _context3.next = 14;\n              return Promise.resolve(_this3.save.enterSaveMode());\n            case 14:\n              if (!(name === 'library' && !((_this3$library = _this3.library) !== null && _this3$library !== void 0 && _this3$library.inSpace))) {\n                _context3.next = 17;\n                break;\n              }\n              _context3.next = 17;\n              return Promise.resolve(_this3.library.enterSpace());\n            case 17:\n              _context3.next = 22;\n              break;\n            case 19:\n              _context3.prev = 19;\n              _context3.t0 = _context3[\"catch\"](0);\n              console.warn(\"Failed to enter mode \\\"\".concat(name, \"\\\"\"), _context3.t0);\n            case 22:\n              _this3._updateSoundscapeButton();\n            case 23:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, null, [[0, 19]]);\n      }))();\n    },\n    goTo: function goTo(name) {\n      var _this4 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        var wasTargetActive, activeBefore, _this4$save, _this4$save$forceRese, _iterator, _step, mode;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              if (!_this4._locked) {\n                _context4.next = 2;\n                break;\n              }\n              return _context4.abrupt(\"return\");\n            case 2:\n              _this4._locked = true;\n              window.__modeTransitioning = true;\n              wasTargetActive = name ? _this4.isActive(name) : false;\n              activeBefore = ['evolve', 'save', 'library'].filter(function (mode) {\n                return _this4.isActive(mode);\n              });\n              _context4.prev = 6;\n              // Ensure Save mode is clean even if it wasn't marked active\n              if (name !== 'save') {\n                (_this4$save = _this4.save) === null || _this4$save === void 0 || (_this4$save$forceRese = _this4$save.forceReset) === null || _this4$save$forceRese === void 0 || _this4$save$forceRese.call(_this4$save, {\n                  restoreMaterials: true\n                });\n              }\n              _iterator = _createForOfIteratorHelper(activeBefore);\n              _context4.prev = 9;\n              _iterator.s();\n            case 11:\n              if ((_step = _iterator.n()).done) {\n                _context4.next = 17;\n                break;\n              }\n              mode = _step.value;\n              _context4.next = 15;\n              return _this4.exit(mode, {\n                skipNormalize: true\n              });\n            case 15:\n              _context4.next = 11;\n              break;\n            case 17:\n              _context4.next = 22;\n              break;\n            case 19:\n              _context4.prev = 19;\n              _context4.t0 = _context4[\"catch\"](9);\n              _iterator.e(_context4.t0);\n            case 22:\n              _context4.prev = 22;\n              _iterator.f();\n              return _context4.finish(22);\n            case 25:\n              _context4.next = 27;\n              return _this4._closeToMain();\n            case 27:\n              if (!(!name || wasTargetActive)) {\n                _context4.next = 29;\n                break;\n              }\n              return _context4.abrupt(\"return\");\n            case 29:\n              _context4.next = 31;\n              return _this4.enter(name);\n            case 31:\n              _context4.prev = 31;\n              requestAnimationFrame(function () {\n                window.__modeTransitioning = false;\n              });\n              _this4._locked = false;\n              return _context4.finish(31);\n            case 35:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, null, [[6,, 31, 35], [9, 19, 22, 25]]);\n      }))();\n    }\n  };\n  window.modeManager = modeManager;\n  var BTN_SELECTORS = {\n    evolve: '#evolve-btn',\n    save: '#save-btn',\n    library: '#library-btn'\n  };\n  function resolveBtnElement(btn, selector) {\n    // Accept direct HTMLElement\n    if (btn && _typeof(btn) === 'object') {\n      if (btn instanceof HTMLElement) return btn;\n      if (btn.element instanceof HTMLElement) return btn.element;\n      if (btn.el instanceof HTMLElement) return btn.el;\n      if (typeof btn.getElement === 'function') {\n        try {\n          var el = btn.getElement();\n          if (el instanceof HTMLElement) return el;\n        } catch (_unused2) {}\n      }\n    }\n    // Fallback: query by selector\n    if (selector && typeof document !== 'undefined') {\n      var _el = document.querySelector(selector);\n      if (_el instanceof HTMLElement) return _el;\n    }\n    return null;\n  }\n\n  // Centralized mode toggle handler\n  var handleModeToggle = function handleModeToggle(mode) {\n    console.log(\"\\uD83C\\uDFAF Mode toggle requested: \".concat(mode));\n\n    // Just trigger mode change\n    modeManager.goTo(mode);\n  };\n\n  // Attach handlers directly to button elements (one handler per button)\n  var attachModeHandler = function attachModeHandler(btnObj, selector, mode) {\n    var _window$navigationCon;\n    var el = resolveBtnElement(btnObj, selector);\n    if (!el) {\n      console.warn(\"Could not resolve button element for \".concat(mode));\n      return;\n    }\n\n    // CRITICAL: Remove old handlers first\n    var oldHandler = el._modeHandler;\n    if (oldHandler) {\n      el.removeEventListener('click', oldHandler, true);\n    }\n\n    // Remove inline onclick\n    el.onclick = null;\n\n    // Create new handler\n    var handler = function handler(e) {\n      e.preventDefault();\n      e.stopPropagation();\n      hoverHandlers === null || hoverHandlers === void 0 || hoverHandlers.hide();\n      console.log(\"\\uD83C\\uDFAF Button clicked: \".concat(mode));\n      handleModeToggle(mode);\n    };\n\n    // Store reference to handler for later removal\n    el._modeHandler = handler;\n\n    // Add handler\n    el.addEventListener('click', handler, {\n      capture: true\n    });\n\n    // NEW: Add hover listeners for message display\n    var hoverHandlers = (_window$navigationCon = window.navigationContainers) === null || _window$navigationCon === void 0 ? void 0 : _window$navigationCon.hoverMessage;\n    if (hoverHandlers) {\n      el.addEventListener('mouseenter', function () {\n        var mm = window.modeManager;\n        var anyModeActive = (mm === null || mm === void 0 ? void 0 : mm.isActive('save')) || (mm === null || mm === void 0 ? void 0 : mm.isActive('evolve')) || (mm === null || mm === void 0 ? void 0 : mm.isActive('library'));\n        if (!anyModeActive) {\n          hoverHandlers.show(mode);\n        }\n      });\n      el.addEventListener('mouseleave', function () {\n        hoverHandlers.hide();\n      });\n    }\n\n    // Update button object reference if needed\n    if (btnObj && _typeof(btnObj) === 'object' && !(btnObj instanceof HTMLElement)) {\n      if (btnObj.button) btnObj.button = el;\n      if (btnObj.element) btnObj.element = el;\n      if (btnObj.el) btnObj.el = el;\n    }\n    console.log(\"\\u2705 Attached mode handler for \".concat(mode));\n  };\n\n  // Attach to each mode button\n  attachModeHandler(evolvingUI === null || evolvingUI === void 0 ? void 0 : evolvingUI.evolveBtn, BTN_SELECTORS.evolve, 'evolve');\n  attachModeHandler((_saveMode = saveMode) === null || _saveMode === void 0 ? void 0 : _saveMode.saveBtn, BTN_SELECTORS.save, 'save');\n  attachModeHandler(library === null || library === void 0 ? void 0 : library.libraryBtn, BTN_SELECTORS.library, 'library');\n  // Remove the main-scene click-to-play handler to avoid interrupting sequential mode\n  // setupSolidClickHandler(pythonComm, surroundController);\n\n  // Expose library for debugging\n  window.library = library;\n\n  // CHANGED: Re-enable click-to-play with soundscape pause/resume\n  setupSolidClickHandler(pythonComm, surroundController);\n  animate();\n}\nfunction animate() {\n  requestAnimationFrame(animate);\n\n  // Skip updates and rendering while switching modes (prevents one-frame flash)\n  if (window.__modeTransitioning) {\n    return;\n  }\n  particleSystem.update(staticFrequencyData);\n  if (saveMode) {\n    saveMode.update3DIconPositions();\n  }\n\n  // Keep library info panel pinned near the selected solid\n  if (window.library && window.library.inSpace) {\n    window.library.update();\n  }\n\n  // Update dynamic grid\n  var time = performance.now() * 0.001;\n  if (scene.userData.dynamicGrid) {\n    scene.userData.dynamicGrid.material.uniforms.time.value = time;\n  }\n\n  // Update film grain\n  if (grainPass) {\n    grainPass.uniforms.time.value = time;\n  }\n\n  // Minimal light animation\n  if (scene.userData.keyLight) {\n    var lightRadius = 60;\n    scene.userData.keyLight.position.x = Math.cos(time * 0.03) * lightRadius;\n    scene.userData.keyLight.position.z = Math.sin(time * 0.03) * lightRadius;\n  }\n\n  // Animate floating lines \n  if (scene.userData.floatingLines) {\n    scene.userData.floatingLines.children.forEach(function (line) {\n      var userData = line.userData;\n      if (userData.movementType === 'horizontal') {\n        line.position.z += userData.speed * userData.direction;\n        line.position.y = userData.originalY + Math.sin(time * userData.oscillationSpeed + line.position.x * 0.01) * userData.oscillationAmplitude;\n        if (line.position.z > 200) line.position.z = -200;\n        if (line.position.z < -200) line.position.z = 200;\n      } else if (userData.movementType === 'vertical') {\n        line.position.y += userData.speed * userData.direction;\n        line.position.x = userData.originalX + Math.sin(time * userData.oscillationSpeed + line.position.y * 0.02) * userData.oscillationAmplitude;\n        if (line.position.y > 100) line.position.y = -50;\n        if (line.position.y < -50) line.position.y = 100;\n      } else if (userData.movementType === 'diagonal') {\n        line.position.z += userData.speed * userData.direction;\n        line.position.y = userData.originalZ + Math.sin(time * userData.oscillationSpeed + line.position.z * 0.015) * userData.oscillationAmplitude;\n        line.rotation.z += userData.rotationSpeed;\n        if (line.position.z > 250) line.position.z = -250;\n        if (line.position.z < -250) line.position.z = 250;\n      }\n      var basOpacity = userData.movementType === 'horizontal' ? 0.25 : userData.movementType === 'vertical' ? 0.2 : 0.15;\n      line.material.opacity = basOpacity + Math.sin(time * 1.5 + line.position.x + line.position.z) * 0.1;\n    });\n  }\n  if (scene.userData.stars) {\n    scene.userData.stars.rotation.y += 0.0001;\n    scene.userData.stars.material.size = 1.2 + Math.sin(time * 0.5) * 0.3;\n  }\n\n  // Update camera controls\n  controls.update();\n\n  // Clear renderer\n  renderer.clear();\n\n  // Render with bloom effect\n  composer.render();\n}\nvar lastClickedSolidId = null;\n// ADDED: Expose globally so PythonCommunication can reset it\nwindow.lastClickedSolidId = null;\nfunction setupSolidClickHandler(pythonComm, surroundController) {\n  window.addEventListener('click', /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(event) {\n      var _window$modeManager14, _window$modeManager15, _window$modeManager16;\n      var isSaveMode, isEvolveMode, isLibraryMode, target, mouse, raycaster, solids, intersects, clickedObject, solid, solutionId, isClickingSameSolid, _wasSoundscapePlaying, wasSoundscapePlaying, userWantedSoundscape, _surroundController$_, currentId, currentSource;\n      return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n        while (1) switch (_context7.prev = _context7.next) {\n          case 0:\n            // ADDED: Ignore clicks if in any special mode\n            isSaveMode = (_window$modeManager14 = window.modeManager) === null || _window$modeManager14 === void 0 ? void 0 : _window$modeManager14.isActive('save');\n            isEvolveMode = (_window$modeManager15 = window.modeManager) === null || _window$modeManager15 === void 0 ? void 0 : _window$modeManager15.isActive('evolve');\n            isLibraryMode = (_window$modeManager16 = window.modeManager) === null || _window$modeManager16 === void 0 ? void 0 : _window$modeManager16.isActive('library');\n            if (!(isSaveMode || isEvolveMode || isLibraryMode)) {\n              _context7.next = 5;\n              break;\n            }\n            return _context7.abrupt(\"return\");\n          case 5:\n            // ADDED: Ignore clicks on UI elements\n            target = event.target;\n            if (!(target.closest('button') || target.closest('.hamburger-menu') || target.closest('.hamburger-options') || target.closest('.name-input-overlay') || target.closest('.library-space-panel'))) {\n              _context7.next = 8;\n              break;\n            }\n            return _context7.abrupt(\"return\");\n          case 8:\n            mouse = new three__WEBPACK_IMPORTED_MODULE_13__.Vector2();\n            mouse.x = event.clientX / window.innerWidth * 2 - 1;\n            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;\n            raycaster = new three__WEBPACK_IMPORTED_MODULE_13__.Raycaster();\n            raycaster.setFromCamera(mouse, camera);\n            solids = particleSystem.getSolids();\n            if (!(solids.length > 0)) {\n              _context7.next = 69;\n              break;\n            }\n            intersects = raycaster.intersectObjects(solids, true);\n            if (!(intersects.length > 0)) {\n              _context7.next = 69;\n              break;\n            }\n            clickedObject = intersects[0].object;\n            solid = clickedObject;\n            while (solid.parent && !solids.includes(solid)) {\n              solid = solid.parent;\n            }\n            if (!(solid.userData && solid.userData.solution && surroundController)) {\n              _context7.next = 69;\n              break;\n            }\n            solutionId = solid.userData.solution.id; // Check if clicking the same solid\n            isClickingSameSolid = window.lastClickedSolidId === solutionId; // If clicking same solid, deselect and stop\n            if (!isClickingSameSolid) {\n              _context7.next = 37;\n              break;\n            }\n            console.log(\"\\uD83D\\uDD32 Deselecting solid \".concat(solutionId));\n            _context7.prev = 25;\n            _context7.next = 28;\n            return surroundController.stopOneShotById(solutionId, 200);\n          case 28:\n            _context7.next = 33;\n            break;\n          case 30:\n            _context7.prev = 30;\n            _context7.t0 = _context7[\"catch\"](25);\n            console.warn(\"Failed to stop one-shot \".concat(solutionId, \":\"), _context7.t0);\n          case 33:\n            window.lastClickedSolidId = null;\n            _wasSoundscapePlaying = surroundController._userRequestedPlay;\n            if (_wasSoundscapePlaying) {\n              console.log(\"\\uD83D\\uDD04 Resuming soundscape after deselection\");\n              setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n                return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n                  while (1) switch (_context5.prev = _context5.next) {\n                    case 0:\n                      _context5.next = 2;\n                      return surroundController.playAll(5, {\n                        userInitiated: true,\n                        force: true\n                      });\n                    case 2:\n                    case \"end\":\n                      return _context5.stop();\n                  }\n                }, _callee5);\n              })), 300);\n            }\n            return _context7.abrupt(\"return\");\n          case 37:\n            // FIXED: Capture soundscape state BEFORE stopping anything\n            wasSoundscapePlaying = surroundController._seqActive;\n            userWantedSoundscape = surroundController._userRequestedPlay;\n            console.log(\"\\uD83C\\uDFB5 Clicked solid \".concat(solutionId));\n            console.log(\"   Previous solid: \".concat(window.lastClickedSolidId));\n            console.log(\"   Soundscape was active: \".concat(wasSoundscapePlaying));\n\n            // CRITICAL: Stop previous solid FIRST and WAIT for it to complete\n            if (!(window.lastClickedSolidId != null)) {\n              _context7.next = 54;\n              break;\n            }\n            console.log(\"\\uD83D\\uDED1 Stopping previous solid \".concat(window.lastClickedSolidId, \" before playing \").concat(solutionId));\n            _context7.prev = 44;\n            _context7.next = 47;\n            return surroundController.stopOneShotById(window.lastClickedSolidId, 150);\n          case 47:\n            _context7.next = 52;\n            break;\n          case 49:\n            _context7.prev = 49;\n            _context7.t1 = _context7[\"catch\"](44);\n            console.warn(\"Failed to stop previous one-shot \".concat(window.lastClickedSolidId, \":\"), _context7.t1);\n          case 52:\n            _context7.next = 54;\n            return new Promise(function (resolve) {\n              return setTimeout(resolve, 50);\n            });\n          case 54:\n            if (!wasSoundscapePlaying) {\n              _context7.next = 64;\n              break;\n            }\n            surroundController.stopSequential();\n            currentId = surroundController._currentId;\n            if (currentId != null) {\n              currentSource = surroundController.sources.get(currentId);\n              if (currentSource && surroundController._isSourcePlaying(currentSource)) {\n                console.log(\"   Stopping sequential sound: \".concat(currentId));\n                surroundController._stopSource(currentSource, true);\n              }\n              surroundController._unhighlightSource(currentId);\n            }\n            surroundController.clearAllGreenOutlines();\n            surroundController._currentId = null;\n            (_surroundController$_ = surroundController._emitPlaybackState) === null || _surroundController$_ === void 0 || _surroundController$_.call(surroundController, false);\n            console.log(' Soundscape stopped completely');\n\n            // ADDED: Small delay after stopping soundscape\n            _context7.next = 64;\n            return new Promise(function (resolve) {\n              return setTimeout(resolve, 50);\n            });\n          case 64:\n            if (wasSoundscapePlaying) {\n              surroundController._userRequestedPlay = true;\n            }\n\n            // NOW play the new solid (after everything is stopped)\n            console.log(\"\\u25B6\\uFE0F Starting playback of solid \".concat(solutionId));\n            surroundController.playOneShot(solutionId, {\n              highlightMesh: solid,\n              onEnded: function onEnded() {\n                console.log(\"\\u2705 Solid \".concat(solutionId, \" finished playing\"));\n                if (wasSoundscapePlaying && surroundController._userRequestedPlay) {\n                  setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n                    var _surroundController$h;\n                    var hasManualPlayback;\n                    return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n                      while (1) switch (_context6.prev = _context6.next) {\n                        case 0:\n                          hasManualPlayback = ((_surroundController$h = surroundController.hasActiveOneShots) === null || _surroundController$h === void 0 ? void 0 : _surroundController$h.call(surroundController)) || false;\n                          if (hasManualPlayback) {\n                            _context6.next = 5;\n                            break;\n                          }\n                          console.log(\"\\uD83D\\uDD04 RESUMING soundscape\");\n                          _context6.next = 5;\n                          return surroundController.playAll(5, {\n                            userInitiated: true,\n                            force: true\n                          });\n                        case 5:\n                        case \"end\":\n                          return _context6.stop();\n                      }\n                    }, _callee6);\n                  })), 1000);\n                }\n                if (window.lastClickedSolidId === solutionId) {\n                  window.lastClickedSolidId = null;\n                }\n              },\n              allowOverlap: false\n            });\n            window.lastClickedSolidId = solutionId;\n            console.log(\"\\u2705 Now tracking solid \".concat(solutionId));\n          case 69:\n          case \"end\":\n            return _context7.stop();\n        }\n      }, _callee7, null, [[25, 30], [44, 49]]);\n    }));\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }());\n}\nwindow.testPythonConnection = function () {\n  console.log(' MANUAL CONNECTION TEST');\n  if (window.pythonComm) {\n    window.pythonComm.logConnectionStatus();\n  } else {\n    console.error(' Python communication not available');\n  }\n};\nwindow.sendTestMessage = function () {\n  console.log(' SENDING TEST MESSAGE TO PYTHON');\n  if (window.pythonComm && window.pythonComm.isConnected()) {\n    window.pythonComm.websocket.send(JSON.stringify({\n      action: 'test',\n      message: 'Hello from JavaScript!',\n      timestamp: Date.now()\n    }));\n    console.log(' Test message sent');\n  } else {\n    console.error(' Not connected to Python');\n  }\n};\n\n// Helper button because of chrome not auto play policy\nfunction createSoundscapeToggle(surroundController) {\n  var _surroundController$h2, _surroundController$h3;\n  // Remove any existing toggle\n  var existing = document.getElementById('soundscape-toggle-btn');\n  if (existing) existing.remove();\n  var btn = document.createElement('button');\n  btn.id = 'soundscape-toggle-btn';\n  btn.className = 'soundscape-toggle-btn';\n  btn.title = 'Play Soundscape';\n  var img = document.createElement('img');\n  img.src = '/assets/icons/Play.svg'; // Changed from 'Start soundscape.svg'\n  img.alt = 'Play Soundscape';\n  btn.appendChild(img);\n  var isPlaying = (_surroundController$h2 = surroundController === null || surroundController === void 0 || (_surroundController$h3 = surroundController.hasUserRequestedSoundscape) === null || _surroundController$h3 === void 0 ? void 0 : _surroundController$h3.call(surroundController)) !== null && _surroundController$h2 !== void 0 ? _surroundController$h2 : false;\n  var applyState = function applyState(playing) {\n    isPlaying = !!playing;\n    if (isPlaying) {\n      img.src = '/assets/icons/Stop.svg';\n      img.alt = 'Stop Soundscape';\n      btn.title = 'Stop Soundscape';\n    } else {\n      img.src = '/assets/icons/Play.svg';\n      img.alt = 'Play Soundscape';\n      btn.title = 'Play Soundscape';\n    }\n  };\n  applyState(isPlaying);\n  btn.addEventListener('click', /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8(e) {\n      var _surroundController$h4;\n      return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n        while (1) switch (_context8.prev = _context8.next) {\n          case 0:\n            e.preventDefault();\n            _context8.prev = 1;\n            if (isPlaying) {\n              _context8.next = 8;\n              break;\n            }\n            _context8.next = 5;\n            return surroundController.playAll(5, {\n              userInitiated: true\n            });\n          case 5:\n            applyState((_surroundController$h4 = surroundController.hasUserRequestedSoundscape) === null || _surroundController$h4 === void 0 ? void 0 : _surroundController$h4.call(surroundController));\n            _context8.next = 11;\n            break;\n          case 8:\n            _context8.next = 10;\n            return surroundController.stopUserSoundscape(500);\n          case 10:\n            applyState(false);\n          case 11:\n            _context8.next = 17;\n            break;\n          case 13:\n            _context8.prev = 13;\n            _context8.t0 = _context8[\"catch\"](1);\n            console.warn('Failed to toggle soundscape:', _context8.t0);\n            applyState(false);\n          case 17:\n          case \"end\":\n            return _context8.stop();\n        }\n      }, _callee8, null, [[1, 13]]);\n    }));\n    return function (_x2) {\n      return _ref5.apply(this, arguments);\n    };\n  }());\n  var stateHandler = function stateHandler(event) {\n    var _event$detail;\n    applyState(!!((_event$detail = event.detail) !== null && _event$detail !== void 0 && _event$detail.playing));\n  };\n  window.addEventListener('surround-playback-state', stateHandler);\n  document.body.appendChild(btn);\n  return btn;\n}\nfunction createTitleScreen() {\n  // Create title screen container\n  var titleScreen = document.createElement('div');\n  titleScreen.id = 'title-screen';\n  titleScreen.className = 'title-screen';\n\n  // Create stars background canvas\n  var starsCanvas = document.createElement('canvas');\n  starsCanvas.className = 'title-stars-canvas';\n  starsCanvas.width = window.innerWidth;\n  starsCanvas.height = window.innerHeight;\n\n  // Create logo container\n  var logoContainer = document.createElement('div');\n  logoContainer.className = 'title-logo-container';\n  var logoImg = document.createElement('img');\n  logoImg.src = '/assets/icons/Logo.svg';\n  logoImg.alt = 'Logo';\n  logoImg.className = 'title-logo';\n  logoContainer.appendChild(logoImg);\n\n  // Create \"press anywhere\" message\n  var pressMessage = document.createElement('div');\n  pressMessage.className = 'title-press-message';\n  pressMessage.textContent = 'Press anywhere to continue';\n\n  // Assemble title screen\n  titleScreen.appendChild(starsCanvas);\n  titleScreen.appendChild(logoContainer);\n  titleScreen.appendChild(pressMessage);\n  document.body.appendChild(titleScreen);\n\n  // Animate stars on canvas\n  var ctx = starsCanvas.getContext('2d');\n  var stars = [];\n  var starsCount = 300;\n\n  // Initialize stars\n  for (var i = 0; i < starsCount; i++) {\n    stars.push({\n      x: Math.random() * starsCanvas.width,\n      y: Math.random() * starsCanvas.height,\n      radius: Math.random() * 2 + 0.5,\n      opacity: Math.random() * 0.7 + 0.3,\n      speed: Math.random() * 0.3 + 0.1,\n      twinkleSpeed: Math.random() * 0.02 + 0.01,\n      twinklePhase: Math.random() * Math.PI * 2,\n      // Color variation\n      color: Math.random() < 0.3 ? 'rgb(150, 180, 255)' :\n      // Blue-white\n      Math.random() < 0.7 ? 'rgb(200, 220, 255)' :\n      // White\n      'rgb(255, 240, 200)' // Slight yellow\n    });\n  }\n  function animateStars() {\n    // Clear with dark gradient background\n    var gradient = ctx.createRadialGradient(starsCanvas.width / 2, starsCanvas.height / 2, 0, starsCanvas.width / 2, starsCanvas.height / 2, starsCanvas.width / 2);\n    gradient.addColorStop(0, '#0a0a20');\n    gradient.addColorStop(0.4, '#060a18');\n    gradient.addColorStop(0.8, '#040815');\n    gradient.addColorStop(1, '#020205');\n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, 0, starsCanvas.width, starsCanvas.height);\n\n    // Draw and update stars\n    stars.forEach(function (star) {\n      // Twinkle effect\n      star.twinklePhase += star.twinkleSpeed;\n      var twinkle = Math.sin(star.twinklePhase) * 0.3 + 0.7;\n      ctx.beginPath();\n      ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);\n      ctx.fillStyle = star.color;\n      ctx.globalAlpha = star.opacity * twinkle;\n      ctx.fill();\n\n      // Slow drift\n    });\n    ctx.globalAlpha = 1;\n    if (titleScreen.parentElement) {\n      requestAnimationFrame(animateStars);\n    }\n  }\n  animateStars();\n\n  // Handle window resize\n  var resizeHandler = function resizeHandler() {\n    starsCanvas.width = window.innerWidth;\n    starsCanvas.height = window.innerHeight;\n\n    // Redistribute stars\n    stars.forEach(function (star) {\n      if (star.x > starsCanvas.width) star.x = Math.random() * starsCanvas.width;\n      if (star.y > starsCanvas.height) star.y = Math.random() * starsCanvas.height;\n    });\n  };\n  window.addEventListener('resize', resizeHandler);\n\n  // Remove title screen on any click/key\n  var removeTitleScreen = function removeTitleScreen() {\n    titleScreen.classList.add('fade-out');\n\n    // Start main scene initialization earlier (while title is still fading)\n    setTimeout(function () {\n      // Initialize scene in background\n      init();\n    }, 300); // Start after 300ms\n\n    // Remove title screen after full fade\n    setTimeout(function () {\n      titleScreen.remove();\n      window.removeEventListener('resize', resizeHandler);\n    }, 1500); // Match CSS animation duration\n  };\n  titleScreen.addEventListener('click', removeTitleScreen);\n  window.addEventListener('keydown', removeTitleScreen, {\n    once: true\n  });\n}\n\n// Initialize the application\ncreateTitleScreen();\n\n//# sourceURL=webpack://sound-particle-visualization/./src/main.js?");

/***/ }),

/***/ "./src/styles.css":
/*!************************!*\
  !*** ./src/styles.css ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js */ \"./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/styleDomAPI.js */ \"./node_modules/style-loader/dist/runtime/styleDomAPI.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/insertBySelector.js */ \"./node_modules/style-loader/dist/runtime/insertBySelector.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js */ \"./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/insertStyleElement.js */ \"./node_modules/style-loader/dist/runtime/insertStyleElement.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! !../node_modules/style-loader/dist/runtime/styleTagTransform.js */ \"./node_modules/style-loader/dist/runtime/styleTagTransform.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var _node_modules_css_loader_dist_cjs_js_styles_css__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! !!../node_modules/css-loader/dist/cjs.js!./styles.css */ \"./node_modules/css-loader/dist/cjs.js!./src/styles.css\");\n\n      \n      \n      \n      \n      \n      \n      \n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = (_node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5___default());\noptions.setAttributes = (_node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3___default());\n\n      options.insert = _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2___default().bind(null, \"head\");\n    \noptions.domAPI = (_node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1___default());\noptions.insertStyleElement = (_node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4___default());\n\nvar update = _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0___default()(_node_modules_css_loader_dist_cjs_js_styles_css__WEBPACK_IMPORTED_MODULE_6__[\"default\"], options);\n\n\n\n\n       /* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (_node_modules_css_loader_dist_cjs_js_styles_css__WEBPACK_IMPORTED_MODULE_6__[\"default\"] && _node_modules_css_loader_dist_cjs_js_styles_css__WEBPACK_IMPORTED_MODULE_6__[\"default\"].locals ? _node_modules_css_loader_dist_cjs_js_styles_css__WEBPACK_IMPORTED_MODULE_6__[\"default\"].locals : undefined);\n\n\n//# sourceURL=webpack://sound-particle-visualization/./src/styles.css?");

/***/ })

},
/******/ __webpack_require__ => { // webpackRuntimeModules
/******/ var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
/******/ __webpack_require__.O(0, ["three","vendors","components"], () => (__webpack_exec__("./src/main.js")));
/******/ var __webpack_exports__ = __webpack_require__.O();
/******/ }
]);